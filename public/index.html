<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CodeBuddy</title>
    <link rel="icon" href="/favicon.ico" sizes="any" />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="/image/codebuddy.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="/image/codebuddy.png"
    />
    <link rel="apple-touch-icon" href="/image/codebuddy.png" />
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/d3@7"></script>
    <script src="https://unpkg.com/@hapi/nes@13/lib/client.js"></script>
    <link rel="stylesheet" href="/css/style.css" />
  </head>
  <body>
    <div id="app">
      <header>
        <div class="container" style="display: flex; align-items: center">
          <div class="header-content">
            <img
              src="/image/codebuddy.png"
              alt="CodeBuddy"
              class="logo"
              @click="resetToHome"
            />
            <h1>CodeBuddy</h1>
            <span
              v-if="serverReadOnly"
              class="read-only-badge"
              title="Server is in read-only mode"
            >
              Read-Only
            </span>
          </div>
          <div class="header-nav">
            <button
              v-if="selectedProject"
              class="nav-item"
              :class="{ active: showAnalysisView }"
              @click="toggleAnalysisView"
              title="View code analysis"
            >
              Analysis
            </button>
            <button
              class="nav-item"
              :class="{ active: showJobsView }"
              @click="toggleJobsView"
            >
              Jobs
              <span v-if="jobQueueStats.running > 0" class="nav-badge running"
                >{{ jobQueueStats.running }}</span
              >
              <span v-else-if="jobQueueStats.queued > 0" class="nav-badge"
                >{{ jobQueueStats.queued }}</span
              >
            </button>
          </div>
        </div>
      </header>

      <div class="container">
        <div class="layout">
          <div class="sidebar">
            <div class="card">
              <div
                style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  border-bottom: 1px solid #eee;
                  padding-bottom: 10px;
                  margin-bottom: 10px;
                "
              >
                <h2 style="margin: 0; border: none; padding: 0">Projects</h2>
                <button class="btn-import" @click="showImportModal = true">
                  + Import
                </button>
              </div>
              <div v-if="loadingProjects" class="loading">Loading...</div>
              <div v-else>
                <div
                  v-for="project in projects"
                  :key="project.name"
                  class="project-item"
                  :class="{ active: selectedProject?.name === project.name }"
                  @click="selectProject(project)"
                >
                  <div class="project-name">{{ project.name }}</div>
                  <div class="project-meta">
                    {{ formatNumber(project.entity_count) }} entities &bull; {{
                    formatNumber(project.source_count) }} files
                  </div>
                  <div class="project-actions" @click.stop>
                    <button
                      class="btn-refresh"
                      @click="refreshProject(project.name)"
                      :disabled="refreshingProject === project.name"
                    >
                      {{ refreshingProject === project.name ? 'Refreshing...' :
                      'Refresh' }}
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="main">
            <!-- Search Card -->
            <div class="card">
              <h2>Search</h2>
              <div class="search-box-autocomplete">
                <div class="autocomplete-wrapper">
                  <input
                    v-model="searchQuery"
                    @input="onSearchInput"
                    @keydown.down.prevent="navigateAutocomplete(1)"
                    @keydown.up.prevent="navigateAutocomplete(-1)"
                    @keydown.enter.prevent="selectAutocompleteItem"
                    @keydown.escape="closeAutocomplete"
                    @focus="showAutocomplete = searchSuggestions.length > 0"
                    @blur="onSearchBlur"
                    placeholder="Search functions, classes, structs..."
                    autocomplete="off"
                  />
                  <div
                    v-if="showAutocomplete && searchSuggestions.length > 0"
                    class="autocomplete-dropdown"
                  >
                    <div
                      v-for="(fn, index) in searchSuggestions"
                      :key="fn.id"
                      class="autocomplete-item"
                      :class="{ highlighted: autocompleteIndex === index }"
                      @mousedown.prevent="selectSuggestion(fn)"
                      @mouseenter="autocompleteIndex = index"
                    >
                      <div class="autocomplete-name">
                        <span class="entity-type-badge" :class="fn.type"
                          >{{ fn.type }}</span
                        >
                        {{ fn.symbol }}{{ fn.parameters || '' }}
                      </div>
                      <div class="autocomplete-location">
                        <span
                          v-if="fn.project_name"
                          class="autocomplete-project"
                          >{{ fn.project_name }} /</span
                        >
                        {{ fn.filename }}:{{ fn.start_line }}
                      </div>
                    </div>
                  </div>
                </div>
                <button @click="searchFunctions" :disabled="!searchQuery">
                  Search
                </button>
              </div>

              <div v-if="searchResults.length > 0" class="function-list">
                <div
                  v-for="fn in searchResults"
                  :key="fn.id"
                  class="function-item"
                  @click="selectFunction(fn)"
                >
                  <div class="function-name">
                    <span class="entity-type-badge" :class="fn.type"
                      >{{ fn.type }}</span
                    >
                    {{ fn.symbol }}{{ fn.parameters || '' }}
                  </div>
                  <div class="function-location">
                    <span v-if="fn.project_name" class="result-project"
                      >{{ fn.project_name }} /</span
                    >
                    {{ fn.filename }}:{{ fn.start_line }}
                  </div>
                </div>
              </div>
              <div v-else-if="hasSearched" class="empty-state">
                No results found
              </div>
            </div>

            <!-- Call Graph / Flowchart View -->
            <div v-if="showCallGraph && !showAnalysisView" class="card">
              <div class="breadcrumb">
                <span class="breadcrumb-item" @click="closeCallGraph"
                  >{{ selectedProject?.name }}</span
                >
                <span class="breadcrumb-separator">›</span>
                <span class="breadcrumb-current"
                  >{{ graphViewType === 'callgraph' ? 'Call Graph' :
                  graphViewType === 'callers' ? 'Caller Tree' : 'Callee Tree'
                  }}: {{ callGraphRoot }}</span
                >
              </div>

              <!-- View Type Selector -->
              <div class="graph-view-selector">
                <div class="view-tabs">
                  <button
                    class="view-tab"
                    :class="{ active: graphViewType === 'callgraph' }"
                    @click="switchGraphView('callgraph')"
                  >
                    Call Graph
                  </button>
                  <button
                    class="view-tab"
                    :class="{ active: graphViewType === 'callers' }"
                    @click="switchGraphView('callers')"
                  >
                    Caller Tree
                  </button>
                  <button
                    class="view-tab"
                    :class="{ active: graphViewType === 'callees' }"
                    @click="switchGraphView('callees')"
                  >
                    Callee Tree
                  </button>
                </div>
                <div
                  v-if="graphViewType !== 'callgraph'"
                  class="depth-selector"
                >
                  <label>Depth:</label>
                  <select v-model="treeDepth" @change="reloadTreeView">
                    <option :value="1">1</option>
                    <option :value="2">2</option>
                    <option :value="3">3</option>
                    <option :value="4">4</option>
                    <option :value="5">5</option>
                    <option :value="-1">Unlimited</option>
                  </select>
                </div>
                <div
                  v-if="graphViewType === 'callgraph'"
                  class="depth-selector"
                >
                  <label>Depth:</label>
                  <select
                    :value="callGraphDepth"
                    @change="setCallGraphDepth(parseInt($event.target.value))"
                  >
                    <option :value="2">2</option>
                    <option :value="3">3</option>
                    <option :value="4">4</option>
                    <option :value="5">5</option>
                    <option :value="6">6</option>
                    <option :value="7">7</option>
                    <option :value="8">8</option>
                    <option :value="9">9</option>
                    <option :value="10">10</option>
                    <option :value="15">15</option>
                    <option :value="20">20</option>
                    <option :value="0">Unlimited</option>
                  </select>
                </div>
              </div>

              <h2>
                {{ graphViewType === 'callgraph' ? 'Call Graph' : graphViewType
                === 'callers' ? 'Caller Tree' : 'Callee Tree' }}: {{
                callGraphRoot }}
              </h2>

              <div v-if="loadingCallGraph" class="loading">
                Loading {{ graphViewType === 'callgraph' ? 'call graph' : 'tree'
                }}...
              </div>
              <!-- Error state: function not found -->
              <div
                v-else-if="callGraphData && callGraphData.error"
                class="empty-state-container"
              >
                <div class="empty-state-icon error">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="48"
                    height="48"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="1.5"
                  >
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="15" y1="9" x2="9" y2="15"></line>
                    <line x1="9" y1="9" x2="15" y2="15"></line>
                  </svg>
                </div>
                <div class="empty-state-title" v-if="callGraphData.notFound">
                  Function Not Found
                </div>
                <div class="empty-state-title" v-else>Error Loading Graph</div>
                <div class="empty-state-message" v-if="callGraphData.notFound">
                  The function <strong>{{ callGraphRoot }}</strong> does not
                  exist in this project.
                  <span v-if="callGraphRoot === 'main'"
                    >This project may not have a main entry point, or it may use
                    a different naming convention.</span
                  >
                </div>
                <div class="empty-state-message" v-else>
                  {{ callGraphData.error }}
                </div>
              </div>
              <!-- Empty state: no graph data (call graph mode) -->
              <div
                v-else-if="graphViewType === 'callgraph' && callGraphData && (!callGraphData.nodes || callGraphData.nodes.length === 0)"
                class="empty-state-container"
              >
                <div class="empty-state-icon warning">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="48"
                    height="48"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="1.5"
                  >
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="12" y1="8" x2="12" y2="12"></line>
                    <line x1="12" y1="16" x2="12.01" y2="16"></line>
                  </svg>
                </div>
                <div class="empty-state-title">No Call Graph Data</div>
                <div class="empty-state-message">
                  This function has no calls to or from other functions in the
                  project.
                </div>
              </div>
              <!-- Empty state: no tree data (caller/callee tree mode) -->
              <div
                v-else-if="graphViewType !== 'callgraph' && treeData && (!treeData.callers || treeData.callers.length === 0) && (!treeData.callees || treeData.callees.length === 0)"
                class="empty-state-container"
              >
                <div class="empty-state-icon warning">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="48"
                    height="48"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="1.5"
                  >
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="12" y1="8" x2="12" y2="12"></line>
                    <line x1="12" y1="16" x2="12.01" y2="16"></line>
                  </svg>
                </div>
                <div class="empty-state-title">
                  No {{ graphViewType === 'callers' ? 'Callers' : 'Callees' }}
                  Found
                </div>
                <div
                  class="empty-state-message"
                  v-if="graphViewType === 'callers'"
                >
                  No functions in this project call
                  <strong>{{ callGraphRoot }}</strong>.
                </div>
                <div class="empty-state-message" v-else>
                  <strong>{{ callGraphRoot }}</strong> does not call any other
                  functions in this project.
                </div>
              </div>
              <div v-else class="graph-container" ref="graphContainer">
                <div class="graph-controls">
                  <button @click="zoomIn">Zoom In</button>
                  <button @click="zoomOut">Zoom Out</button>
                  <button @click="resetZoom">Reset</button>
                </div>
                <svg class="graph-svg" ref="graphSvg"></svg>
                <div v-if="selectedGraphNode" class="node-info-panel">
                  <div class="node-info-header">
                    {{ selectedGraphNode.symbol }}{{
                    selectedGraphNode.parameters || '' }}
                  </div>
                  <div class="node-info-body">
                    <div class="node-info-row">
                      <div class="node-info-label">Location</div>
                      <div class="node-info-value">
                        {{ selectedGraphNode.filename }}:{{
                        selectedGraphNode.start_line }}
                      </div>
                    </div>
                    <div
                      v-if="selectedGraphNode.return_type"
                      class="node-info-row"
                    >
                      <div class="node-info-label">Return Type</div>
                      <div class="node-info-value">
                        {{ selectedGraphNode.return_type }}
                      </div>
                    </div>
                    <div v-if="selectedGraphNode.comment" class="node-info-row">
                      <div class="node-info-label">Comment</div>
                      <div class="node-info-value">
                        {{ selectedGraphNode.comment }}
                      </div>
                    </div>
                    <div v-if="selectedGraphNode.source" class="node-info-row">
                      <div class="node-info-label">Source</div>
                      <div class="node-info-source">
                        {{ selectedGraphNode.source }}
                      </div>
                    </div>
                    <div style="margin-top: 12px">
                      <button
                        class="btn-primary"
                        @click="viewFunctionDetails(selectedGraphNode)"
                      >
                        View Details
                      </button>
                      <button
                        v-if="graphViewType === 'callgraph'"
                        class="btn-secondary"
                        @click="loadCallGraphForNode(selectedGraphNode.symbol)"
                      >
                        Recenter Graph
                      </button>
                      <button
                        v-else
                        class="btn-secondary"
                        @click="recenterTreeOnNode(selectedGraphNode.symbol)"
                      >
                        Recenter Tree
                      </button>
                    </div>
                  </div>
                </div>
                <div class="graph-legend">
                  <template v-if="graphViewType === 'callgraph'">
                    <div class="legend-item">
                      <div
                        class="legend-circle"
                        style="background: #fce4ec; border-color: #e91e63"
                      ></div>
                      <span>Root function</span>
                    </div>
                    <div class="legend-item">
                      <div
                        class="legend-circle"
                        style="background: #e3f2fd; border-color: #2196f3"
                      ></div>
                      <span>Related functions</span>
                    </div>
                    <div class="legend-item">
                      <span style="color: #999"
                        >→ Arrow shows call direction</span
                      >
                    </div>
                  </template>
                  <template v-else>
                    <div class="legend-item">
                      <div
                        class="legend-circle"
                        style="background: #fce4ec; border-color: #e91e63"
                      ></div>
                      <span>Root function</span>
                    </div>
                    <div class="legend-item">
                      <div
                        class="legend-circle"
                        style="background: #e8f5e9; border-color: #4caf50"
                      ></div>
                      <span
                        >{{ graphViewType === 'callers' ? 'Callers' : 'Callees'
                        }}</span
                      >
                    </div>
                    <div class="legend-item">
                      <div
                        class="legend-circle"
                        style="background: #fff3e0; border-color: #ff9800"
                      ></div>
                      <span>Truncated (depth limit)</span>
                    </div>
                    <div class="legend-item">
                      <div
                        class="legend-circle"
                        style="background: #fce4ec; border-color: #9c27b0"
                      ></div>
                      <span>Loop detected</span>
                    </div>
                  </template>
                </div>
              </div>
            </div>

            <!-- Jobs View -->
            <div v-if="showJobsView && !showAnalysisView" class="card">
              <h2>Job Queue</h2>

              <!-- Stats Summary -->
              <div class="job-stats-summary">
                <div class="job-stat">
                  <span class="job-stat-value"
                    >{{ jobQueueStats.running }}</span
                  >
                  <span class="job-stat-label">Running</span>
                </div>
                <div class="job-stat">
                  <span class="job-stat-value">{{ jobQueueStats.queued }}</span>
                  <span class="job-stat-label">Queued</span>
                </div>
                <div class="job-stat">
                  <span class="job-stat-value"
                    >{{ jobQueueStats.completed }}</span
                  >
                  <span class="job-stat-label">Completed</span>
                </div>
                <div class="job-stat">
                  <span class="job-stat-value">{{ jobQueueStats.failed }}</span>
                  <span class="job-stat-label">Failed</span>
                </div>
              </div>

              <!-- Job List -->
              <div v-if="jobs.length === 0" class="empty-state">
                No jobs in queue. Import or refresh a project to see jobs here.
              </div>

              <div v-else class="job-list">
                <div
                  v-for="job in jobs"
                  :key="job.id"
                  class="job-card"
                  :class="'job-card-' + job.status"
                >
                  <div class="job-card-header">
                    <div class="job-card-title">
                      <span class="job-type-badge">{{ job.type }}</span>
                      <span class="job-name"
                        >{{ job.metadata?.name || job.metadata?.path || job.id
                        }}</span
                      >
                    </div>
                    <span class="job-status-badge" :class="job.status"
                      >{{ job.status }}</span
                    >
                  </div>

                  <div class="job-card-details">
                    <div v-if="job.metadata?.path" class="job-detail">
                      <span class="job-detail-label">Path:</span>
                      <span class="job-detail-value"
                        >{{ job.metadata.path }}</span
                      >
                    </div>
                    <div class="job-detail">
                      <span class="job-detail-label">Created:</span>
                      <span class="job-detail-value"
                        >{{ formatDate(job.created_at) }}</span
                      >
                    </div>
                    <div v-if="job.started_at" class="job-detail">
                      <span class="job-detail-label">Started:</span>
                      <span class="job-detail-value"
                        >{{ formatDate(job.started_at) }}</span
                      >
                    </div>
                    <div v-if="job.completed_at" class="job-detail">
                      <span class="job-detail-label">Completed:</span>
                      <span class="job-detail-value"
                        >{{ formatDate(job.completed_at) }}</span
                      >
                    </div>
                    <div
                      v-if="job.completed_at && job.started_at"
                      class="job-detail"
                    >
                      <span class="job-detail-label">Duration:</span>
                      <span class="job-detail-value"
                        >{{ formatDuration(job.started_at, job.completed_at)
                        }}</span
                      >
                    </div>
                  </div>

                  <div
                    v-if="job.status === 'running' || job.status === 'queued'"
                    class="job-progress-section"
                  >
                    <div class="job-progress-text">
                      {{ job.message }} ({{ job.progress }}%)
                    </div>
                    <div class="job-progress-bar-large">
                      <div
                        class="job-progress-fill-large"
                        :style="{ width: job.progress + '%' }"
                      ></div>
                    </div>
                  </div>

                  <div v-if="job.error" class="job-error-section">
                    <div class="job-error-title">Error:</div>
                    <div class="job-error-message">{{ job.error }}</div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Analysis View -->
            <div
              v-if="showAnalysisView && selectedProject"
              class="analysis-dashboard"
            >
              <!-- Loading State -->
              <div v-if="loadingAnalysis" class="card loading">
                Loading analysis...
              </div>

              <!-- Analysis Dashboard with Sidebar -->
              <div v-else-if="analysisData" class="analysis-layout">
                <!-- Sidebar Navigation -->
                <div class="analysis-sidebar">
                  <!-- Health Score -->
                  <div
                    class="sidebar-health"
                    :class="'health-' + analysisData.health_rating.toLowerCase()"
                  >
                    <div class="health-score">
                      {{ analysisData.health_score }}
                    </div>
                    <div class="health-label">
                      {{ analysisData.health_rating }}
                    </div>
                  </div>

                  <!-- Overview -->
                  <div
                    class="sidebar-item"
                    :class="{ active: analysisTab === 'overview' }"
                    @click="setAnalysisTab('overview')"
                  >
                    <span class="sidebar-icon">&#9776;</span>
                    <span class="sidebar-text">Overview</span>
                  </div>

                  <!-- Code Quality Group -->
                  <div class="sidebar-group">
                    <div class="sidebar-group-title">Code Quality</div>
                    <div
                      class="sidebar-item"
                      :class="{ active: analysisTab === 'metrics' }"
                      @click="setAnalysisTab('metrics')"
                    >
                      <span class="sidebar-icon">M</span>
                      <span class="sidebar-text">Metrics</span>
                      <span class="sidebar-badge"
                        >{{
                        analysisData.summaries.metrics.maintainability_rating
                        }}</span
                      >
                    </div>
                    <div
                      class="sidebar-item"
                      :class="{ active: analysisTab === 'code-smells', 'has-issues': analysisData.summaries.code_smells.total_smells > 0 }"
                      @click="setAnalysisTab('code-smells')"
                    >
                      <span class="sidebar-icon">~</span>
                      <span class="sidebar-text">Code Smells</span>
                      <span
                        v-if="analysisData.summaries.code_smells.total_smells > 0"
                        class="sidebar-badge warning"
                        >{{
                        formatNumber(analysisData.summaries.code_smells.total_smells)
                        }}</span
                      >
                    </div>
                    <div
                      class="sidebar-item"
                      :class="{ active: analysisTab === 'duplication', 'has-issues': analysisData.summaries.duplication.duplicate_group_count > 0 }"
                      @click="setAnalysisTab('duplication')"
                    >
                      <span class="sidebar-icon">2x</span>
                      <span class="sidebar-text">Duplication</span>
                      <span
                        v-if="analysisData.summaries.duplication.duplicate_group_count > 0"
                        class="sidebar-badge warning"
                        >{{
                        formatNumber(analysisData.summaries.duplication.duplicate_group_count)
                        }}</span
                      >
                    </div>
                  </div>

                  <!-- Security Group -->
                  <div class="sidebar-group">
                    <div class="sidebar-group-title">Security</div>
                    <div
                      class="sidebar-item"
                      :class="{ active: analysisTab === 'security', 'has-issues': analysisData.summaries.security.total_vulnerabilities > 0, 'has-critical': analysisData.summaries.security.high_severity > 0 }"
                      @click="setAnalysisTab('security')"
                    >
                      <span class="sidebar-icon">!</span>
                      <span class="sidebar-text">Vulnerabilities</span>
                      <span
                        v-if="analysisData.summaries.security.total_vulnerabilities > 0"
                        class="sidebar-badge"
                        :class="{ 'critical': analysisData.summaries.security.high_severity > 0, 'warning': analysisData.summaries.security.high_severity === 0 }"
                        >{{
                        formatNumber(analysisData.summaries.security.total_vulnerabilities)
                        }}</span
                      >
                    </div>
                  </div>

                  <!-- Structure Group -->
                  <div class="sidebar-group">
                    <div class="sidebar-group-title">Structure</div>
                    <div
                      class="sidebar-item"
                      :class="{ active: analysisTab === 'dead-code', 'has-issues': analysisData.summaries.dead_code.dead_function_count > 0 }"
                      @click="setAnalysisTab('dead-code')"
                    >
                      <span class="sidebar-icon">D</span>
                      <span class="sidebar-text">Dead Code</span>
                      <span
                        v-if="analysisData.summaries.dead_code.dead_function_count > 0"
                        class="sidebar-badge warning"
                        >{{
                        formatNumber(analysisData.summaries.dead_code.dead_function_count)
                        }}</span
                      >
                    </div>
                    <div
                      class="sidebar-item"
                      :class="{ active: analysisTab === 'dependencies', 'has-issues': analysisData.summaries.dependencies.circular_dependency_count > 0 }"
                      @click="setAnalysisTab('dependencies')"
                    >
                      <span class="sidebar-icon">&#8644;</span>
                      <span class="sidebar-text">Dependencies</span>
                      <span
                        v-if="analysisData.summaries.dependencies.circular_dependency_count > 0"
                        class="sidebar-badge warning"
                        >{{
                        formatNumber(analysisData.summaries.dependencies.circular_dependency_count)
                        }}</span
                      >
                    </div>
                    <div
                      class="sidebar-item"
                      :class="{ active: analysisTab === 'api-surface' }"
                      @click="setAnalysisTab('api-surface')"
                    >
                      <span class="sidebar-icon">API</span>
                      <span class="sidebar-text">API Surface</span>
                    </div>
                  </div>

                  <!-- Types & Docs Group -->
                  <div class="sidebar-group">
                    <div class="sidebar-group-title">Types & Docs</div>
                    <div
                      class="sidebar-item"
                      :class="{ active: analysisTab === 'types' }"
                      @click="setAnalysisTab('types')"
                    >
                      <span class="sidebar-icon">T</span>
                      <span class="sidebar-text">Type Analysis</span>
                      <span class="sidebar-badge"
                        >{{
                        analysisData.summaries.types.type_coverage_percentage
                        }}%</span
                      >
                    </div>
                    <div
                      class="sidebar-item"
                      :class="{ active: analysisTab === 'documentation', 'has-issues': analysisData.summaries.documentation.coverage_percentage < 50 }"
                      @click="setAnalysisTab('documentation')"
                    >
                      <span class="sidebar-icon">D</span>
                      <span class="sidebar-text">Documentation</span>
                      <span
                        class="sidebar-badge"
                        :class="{ 'warning': analysisData.summaries.documentation.coverage_percentage < 50 }"
                        >{{
                        analysisData.summaries.documentation.coverage_percentage
                        }}%</span
                      >
                    </div>
                    <div
                      class="sidebar-item"
                      :class="{ active: analysisTab === 'scope', 'has-issues': analysisData.summaries.scope.total_issues > 0 }"
                      @click="setAnalysisTab('scope')"
                    >
                      <span class="sidebar-icon">{}</span>
                      <span class="sidebar-text">Variable Scope</span>
                      <span
                        v-if="analysisData.summaries.scope.total_issues > 0"
                        class="sidebar-badge warning"
                        >{{
                        formatNumber(analysisData.summaries.scope.total_issues)
                        }}</span
                      >
                    </div>
                  </div>

                  <!-- Advanced Group -->
                  <div class="sidebar-group">
                    <div class="sidebar-group-title">Advanced</div>
                    <div
                      class="sidebar-item"
                      :class="{ active: analysisTab === 'concurrency' }"
                      @click="setAnalysisTab('concurrency')"
                    >
                      <span class="sidebar-icon">||</span>
                      <span class="sidebar-text">Concurrency</span>
                    </div>
                    <div
                      class="sidebar-item"
                      :class="{ active: analysisTab === 'resources' }"
                      @click="setAnalysisTab('resources')"
                    >
                      <span class="sidebar-icon">R</span>
                      <span class="sidebar-text">Resources</span>
                    </div>
                    <div
                      class="sidebar-item"
                      :class="{ active: analysisTab === 'patterns' }"
                      @click="setAnalysisTab('patterns')"
                    >
                      <span class="sidebar-icon">P</span>
                      <span class="sidebar-text">Patterns</span>
                    </div>
                    <div
                      class="sidebar-item"
                      :class="{ active: analysisTab === 'tests' }"
                      @click="setAnalysisTab('tests')"
                    >
                      <span class="sidebar-icon">T</span>
                      <span class="sidebar-text">Tests</span>
                    </div>
                    <div
                      class="sidebar-item"
                      :class="{ active: analysisTab === 'naming' }"
                      @click="setAnalysisTab('naming')"
                    >
                      <span class="sidebar-icon">N</span>
                      <span class="sidebar-text">Naming</span>
                    </div>
                    <div
                      class="sidebar-item"
                      :class="{ active: analysisTab === 'readability' }"
                      @click="setAnalysisTab('readability')"
                    >
                      <span class="sidebar-icon">R</span>
                      <span class="sidebar-text">Readability</span>
                    </div>
                  </div>
                </div>

                <!-- Main Content Area -->
                <div class="analysis-main">
                  <div class="analysis-header">
                    <div class="breadcrumb">
                      <span class="breadcrumb-item" @click="closeAnalysisView"
                        >{{ selectedProject.name }}</span
                      >
                      <span class="breadcrumb-separator">›</span>
                      <span class="breadcrumb-current">Code Analysis</span>
                    </div>
                  </div>

                  <!-- Overview Tab -->
                  <div
                    v-if="analysisTab === 'overview'"
                    class="analysis-content"
                  >
                    <h2>Analysis Overview</h2>
                    <p class="overview-description">
                      Overall code quality score based on multiple analysis
                      factors.
                    </p>
                    <div class="analysis-summary-grid">
                      <!-- Metrics Summary -->
                      <div
                        class="analysis-summary-card"
                        @click="setAnalysisTab('metrics')"
                      >
                        <div class="summary-icon metrics-icon">M</div>
                        <div class="summary-info">
                          <div class="summary-title">Code Metrics</div>
                          <div class="summary-stat">
                            {{
                            formatNumber(analysisData.summaries.metrics.total_functions)
                            }} functions
                          </div>
                          <div class="summary-detail">
                            Maintainability: {{
                            analysisData.summaries.metrics.maintainability_rating
                            }}
                          </div>
                        </div>
                      </div>

                      <!-- Dead Code Summary -->
                      <div
                        class="analysis-summary-card"
                        :class="{ 'has-issues': analysisData.summaries.dead_code.dead_function_count > 0 }"
                        @click="setAnalysisTab('dead-code')"
                      >
                        <div class="summary-icon dead-code-icon">D</div>
                        <div class="summary-info">
                          <div class="summary-title">Dead Code</div>
                          <div class="summary-stat">
                            {{
                            formatNumber(analysisData.summaries.dead_code.dead_function_count)
                            }} unused functions
                          </div>
                          <div class="summary-detail">
                            {{
                            analysisData.summaries.dead_code.dead_code_percentage
                            }}% dead code
                          </div>
                        </div>
                      </div>

                      <!-- Duplication Summary -->
                      <div
                        class="analysis-summary-card"
                        :class="{ 'has-issues': analysisData.summaries.duplication.duplicate_group_count > 0 }"
                        @click="setAnalysisTab('duplication')"
                      >
                        <div class="summary-icon duplication-icon">2x</div>
                        <div class="summary-info">
                          <div class="summary-title">Code Duplication</div>
                          <div class="summary-stat">
                            {{
                            formatNumber(analysisData.summaries.duplication.duplicate_group_count)
                            }} duplicate groups
                          </div>
                          <div class="summary-detail">
                            {{
                            analysisData.summaries.duplication.duplication_percentage
                            }}% duplicated
                          </div>
                        </div>
                      </div>

                      <!-- Dependencies Summary -->
                      <div
                        class="analysis-summary-card"
                        :class="{ 'has-issues': analysisData.summaries.dependencies.circular_dependency_count > 0 }"
                        @click="setAnalysisTab('dependencies')"
                      >
                        <div class="summary-icon deps-icon">&#8644;</div>
                        <div class="summary-info">
                          <div class="summary-title">Dependencies</div>
                          <div class="summary-stat">
                            {{
                            formatNumber(analysisData.summaries.dependencies.total_dependencies)
                            }} dependencies
                          </div>
                          <div class="summary-detail">
                            {{
                            formatNumber(analysisData.summaries.dependencies.circular_dependency_count)
                            }} circular
                          </div>
                        </div>
                      </div>

                      <!-- Security Summary -->
                      <div
                        class="analysis-summary-card"
                        :class="{ 'has-issues': analysisData.summaries.security.total_vulnerabilities > 0, 'has-critical': analysisData.summaries.security.high_severity > 0 }"
                        @click="setAnalysisTab('security')"
                      >
                        <div class="summary-icon security-icon">!</div>
                        <div class="summary-info">
                          <div class="summary-title">Security</div>
                          <div class="summary-stat">
                            {{
                            formatNumber(analysisData.summaries.security.total_vulnerabilities)
                            }} issues found
                          </div>
                          <div class="summary-detail">
                            {{
                            formatNumber(analysisData.summaries.security.high_severity)
                            }} high severity
                          </div>
                        </div>
                      </div>

                      <!-- Code Smells Summary -->
                      <div
                        class="analysis-summary-card"
                        :class="{ 'has-issues': analysisData.summaries.code_smells.total_smells > 0 }"
                        @click="setAnalysisTab('code-smells')"
                      >
                        <div class="summary-icon smells-icon">~</div>
                        <div class="summary-info">
                          <div class="summary-title">Code Smells</div>
                          <div class="summary-stat">
                            {{
                            formatNumber(analysisData.summaries.code_smells.total_smells)
                            }} smells detected
                          </div>
                          <div class="summary-detail">
                            {{ analysisData.summaries.code_smells.smell_density
                            }}% smell density
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Metrics Tab -->
                  <div
                    v-if="analysisTab === 'metrics'"
                    class="analysis-content"
                  >
                    <div v-if="loadingAnalysisDetail" class="loading-container">
                      <div class="loading-spinner"></div>
                      <div class="loading-text">Loading metrics...</div>
                    </div>
                    <div
                      v-else-if="!analysisDetail"
                      class="empty-state-container"
                    >
                      <div class="empty-state-icon">M</div>
                      <div class="empty-state-title">No Data Available</div>
                      <div class="empty-state-message">
                        Unable to load metrics analysis. Please try again.
                      </div>
                    </div>
                    <div v-else>
                      <div class="metrics-overview">
                        <div class="metric-big-card">
                          <div class="metric-big-value">
                            {{ analysisDetail.maintainability_index }}
                          </div>
                          <div class="metric-big-label">
                            Maintainability Index
                          </div>
                          <div
                            class="metric-big-rating"
                            :class="'rating-' + analysisDetail.maintainability_rating.toLowerCase().replace(' ', '-')"
                          >
                            {{ analysisDetail.maintainability_rating }}
                          </div>
                        </div>
                        <div class="metrics-grid">
                          <div class="metric-card">
                            <div class="metric-value">
                              {{ formatNumber(analysisDetail.function_count) }}
                            </div>
                            <div class="metric-label">Functions</div>
                          </div>
                          <div class="metric-card">
                            <div class="metric-value">
                              {{
                              formatNumber(analysisDetail.aggregate.total_loc)
                              }}
                            </div>
                            <div class="metric-label">Total LOC</div>
                          </div>
                          <div class="metric-card">
                            <div class="metric-value">
                              {{
                              formatNumber(analysisDetail.aggregate.avg_cyclomatic)
                              }}
                            </div>
                            <div class="metric-label">Avg Cyclomatic</div>
                          </div>
                          <div class="metric-card">
                            <div class="metric-value">
                              {{
                              formatNumber(analysisDetail.aggregate.max_cyclomatic)
                              }}
                            </div>
                            <div class="metric-label">Max Cyclomatic</div>
                          </div>
                          <div class="metric-card">
                            <div class="metric-value">
                              {{ formatNumber(analysisDetail.aggregate.avg_loc)
                              }}
                            </div>
                            <div class="metric-label">Avg LOC</div>
                          </div>
                          <div class="metric-card">
                            <div class="metric-value">
                              {{
                              formatNumber(analysisDetail.aggregate.max_nesting_depth)
                              }}
                            </div>
                            <div class="metric-label">Max Nesting</div>
                          </div>
                        </div>
                      </div>
                      <h3>Most Complex Functions</h3>
                      <div class="analysis-table">
                        <div class="table-header">
                          <span>Function</span><span>File</span
                          ><span>Cyclomatic</span><span>LOC</span
                          ><span>Rating</span>
                        </div>
                        <div
                          v-for="fn in analysisDetail.most_complex.slice(0, 10)"
                          :key="fn.id"
                          class="table-row"
                          @click="navigateToFunctionById(fn)"
                        >
                          <span class="fn-name">{{ fn.symbol }}</span>
                          <span class="fn-file"
                            >{{ fn.filename }}:{{ fn.start_line }}</span
                          >
                          <span>{{ fn.cyclomatic }}</span>
                          <span>{{ fn.loc }}</span>
                          <span
                            class="complexity-badge"
                            :class="'complexity-' + fn.rating"
                            >{{ fn.label }}</span
                          >
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Dead Code Tab -->
                  <div
                    v-if="analysisTab === 'dead-code'"
                    class="analysis-content"
                  >
                    <div v-if="loadingAnalysisDetail" class="loading-container">
                      <div class="loading-spinner"></div>
                      <div class="loading-text">
                        Loading dead code analysis...
                      </div>
                    </div>
                    <div
                      v-else-if="!analysisDetail"
                      class="empty-state-container"
                    >
                      <div class="empty-state-icon">&#128683;</div>
                      <div class="empty-state-title">No Data Available</div>
                      <div class="empty-state-message">
                        Unable to load dead code analysis. Please try again.
                      </div>
                    </div>
                    <div v-else-if="analysisDetail">
                      <div class="analysis-stats-bar">
                        <div class="stat-item">
                          <span class="stat-value"
                            >{{
                            formatNumber(analysisDetail.summary.dead_function_count)
                            }}</span
                          ><span class="stat-label">Dead Functions</span>
                        </div>
                        <div class="stat-item">
                          <span class="stat-value"
                            >{{
                            formatNumber(analysisDetail.summary.dead_lines_of_code)
                            }}</span
                          ><span class="stat-label">Dead LOC</span>
                        </div>
                        <div class="stat-item">
                          <span class="stat-value"
                            >{{ analysisDetail.summary.dead_code_percentage
                            }}%</span
                          ><span class="stat-label">Dead Code</span>
                        </div>
                      </div>
                      <h3>Unreferenced Functions</h3>
                      <div
                        v-if="analysisDetail.dead_functions.length === 0"
                        class="empty-state success-state"
                      >
                        No dead code detected!
                      </div>
                      <div v-else class="analysis-table">
                        <div class="table-header">
                          <span>Function</span><span>File</span
                          ><span>Lines</span>
                        </div>
                        <div
                          v-for="fn in analysisDetail.dead_functions"
                          :key="fn.id"
                          class="table-row"
                          @click="navigateToFunctionById(fn)"
                        >
                          <span class="fn-name">{{ fn.symbol }}</span>
                          <span class="fn-file"
                            >{{ fn.filename }}:{{ fn.start_line }}</span
                          >
                          <span>{{ fn.lines }}</span>
                        </div>
                      </div>
                      <div
                        v-if="analysisDetail.potential_entry_points.length > 0"
                      >
                        <h3>Potential Entry Points (may not be dead)</h3>
                        <div class="analysis-table">
                          <div class="table-header">
                            <span>Function</span><span>File</span
                            ><span>Reason</span>
                          </div>
                          <div
                            v-for="fn in analysisDetail.potential_entry_points.slice(0, 20)"
                            :key="fn.id"
                            class="table-row warning-row"
                          >
                            <span class="fn-name">{{ fn.symbol }}</span>
                            <span class="fn-file"
                              >{{ fn.filename }}:{{ fn.start_line }}</span
                            >
                            <span class="fn-reason">{{ fn.reason }}</span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Duplication Tab -->
                  <div
                    v-if="analysisTab === 'duplication'"
                    class="analysis-content"
                  >
                    <div v-if="loadingAnalysisDetail" class="loading-container">
                      <div class="loading-spinner"></div>
                      <div class="loading-text">
                        Loading duplication analysis...
                      </div>
                    </div>
                    <div
                      v-else-if="!analysisDetail"
                      class="empty-state-container"
                    >
                      <div class="empty-state-icon">&#128203;</div>
                      <div class="empty-state-title">No Data Available</div>
                      <div class="empty-state-message">
                        Unable to load duplication analysis. Please try again.
                      </div>
                    </div>
                    <div v-else>
                      <div class="analysis-stats-bar">
                        <div class="stat-item">
                          <span class="stat-value"
                            >{{
                            formatNumber(analysisDetail.summary.duplicate_group_count)
                            }}</span
                          ><span class="stat-label">Duplicate Groups</span>
                        </div>
                        <div class="stat-item">
                          <span class="stat-value"
                            >{{
                            formatNumber(analysisDetail.summary.total_clone_count)
                            }}</span
                          ><span class="stat-label">Total Clones</span>
                        </div>
                        <div class="stat-item">
                          <span class="stat-value"
                            >{{ analysisDetail.summary.duplication_percentage
                            }}%</span
                          ><span class="stat-label">Duplication</span>
                        </div>
                      </div>
                      <div
                        v-if="analysisDetail.duplicate_groups.length === 0"
                        class="empty-state success-state"
                      >
                        No code duplication detected!
                      </div>
                      <div v-else>
                        <div
                          v-for="(group, idx) in analysisDetail.duplicate_groups"
                          :key="idx"
                          class="duplication-group"
                        >
                          <div
                            class="duplication-original"
                            @click="navigateToFunctionById(group.original)"
                          >
                            <span class="dup-label">Original:</span>
                            <span class="fn-name"
                              >{{ group.original.symbol }}</span
                            >
                            <span class="fn-file"
                              >{{ group.original.filename }}:{{
                              group.original.start_line }}</span
                            >
                            <span class="fn-lines"
                              >{{ group.original.lines }} lines</span
                            >
                          </div>
                          <div class="duplication-clones">
                            <div
                              v-for="clone in group.clones"
                              :key="clone.id"
                              class="duplication-clone"
                              @click="navigateToFunctionById(clone)"
                            >
                              <span class="dup-label"
                                >Clone ({{ clone.similarity }}% similar):</span
                              >
                              <span class="fn-name">{{ clone.symbol }}</span>
                              <span class="fn-file"
                                >{{ clone.filename }}:{{ clone.start_line
                                }}</span
                              >
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Dependencies Tab -->
                  <div
                    v-if="analysisTab === 'dependencies'"
                    class="analysis-content"
                  >
                    <div v-if="loadingAnalysisDetail" class="loading-container">
                      <div class="loading-spinner"></div>
                      <div class="loading-text">
                        Loading dependency analysis...
                      </div>
                    </div>
                    <div
                      v-else-if="!analysisDetail"
                      class="empty-state-container"
                    >
                      <div class="empty-state-icon">&#128279;</div>
                      <div class="empty-state-title">No Data Available</div>
                      <div class="empty-state-message">
                        Unable to load dependency analysis. Please try again.
                      </div>
                    </div>
                    <div v-else>
                      <div class="analysis-stats-bar">
                        <div class="stat-item">
                          <span class="stat-value"
                            >{{ formatNumber(analysisDetail.summary.total_files)
                            }}</span
                          ><span class="stat-label">Files</span>
                        </div>
                        <div class="stat-item">
                          <span class="stat-value"
                            >{{
                            formatNumber(analysisDetail.summary.total_dependencies)
                            }}</span
                          ><span class="stat-label">Dependencies</span>
                        </div>
                        <div
                          class="stat-item"
                          :class="{ 'stat-warning': analysisDetail.summary.circular_dependency_count > 0 }"
                        >
                          <span class="stat-value"
                            >{{
                            formatNumber(analysisDetail.summary.circular_dependency_count)
                            }}</span
                          ><span class="stat-label">Circular Deps</span>
                        </div>
                      </div>
                      <div
                        v-if="analysisDetail.circular_dependencies.length > 0"
                      >
                        <h3>Circular Dependencies</h3>
                        <div class="analysis-table">
                          <div class="table-header">
                            <span>File A</span><span></span><span>File B</span>
                          </div>
                          <div
                            v-for="(dep, idx) in analysisDetail.circular_dependencies"
                            :key="idx"
                            class="table-row warning-row"
                          >
                            <span>{{ dep.file_a }}</span>
                            <span class="circular-arrow">&#8644;</span>
                            <span>{{ dep.file_b }}</span>
                          </div>
                        </div>
                      </div>
                      <h3>File Coupling Metrics</h3>
                      <div class="analysis-table">
                        <div class="table-header">
                          <span>File</span><span>Afferent (In)</span
                          ><span>Efferent (Out)</span><span>Instability</span>
                        </div>
                        <div
                          v-for="file in analysisDetail.file_metrics.slice(0, 20)"
                          :key="file.filename"
                          class="table-row"
                        >
                          <span class="fn-file">{{ file.filename }}</span>
                          <span>{{ file.afferent_coupling }}</span>
                          <span>{{ file.efferent_coupling }}</span>
                          <span>{{ file.instability }}</span>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Security Tab -->
                  <div
                    v-if="analysisTab === 'security'"
                    class="analysis-content"
                  >
                    <div v-if="loadingAnalysisDetail" class="loading-container">
                      <div class="loading-spinner"></div>
                      <div class="loading-text">
                        Loading security analysis...
                      </div>
                    </div>
                    <div
                      v-else-if="!analysisDetail"
                      class="empty-state-container"
                    >
                      <div class="empty-state-icon">&#128274;</div>
                      <div class="empty-state-title">No Data Available</div>
                      <div class="empty-state-message">
                        Unable to load security analysis. Please try again.
                      </div>
                    </div>
                    <div v-else-if="analysisDetail">
                      <div class="analysis-stats-bar">
                        <div
                          class="stat-item"
                          :class="{ 'stat-critical': analysisDetail.summary.high_severity > 0 }"
                        >
                          <span class="stat-value"
                            >{{
                            formatNumber(analysisDetail.summary.high_severity)
                            }}</span
                          ><span class="stat-label">High Severity</span>
                        </div>
                        <div
                          class="stat-item"
                          :class="{ 'stat-warning': analysisDetail.summary.medium_severity > 0 }"
                        >
                          <span class="stat-value"
                            >{{
                            formatNumber(analysisDetail.summary.medium_severity)
                            }}</span
                          ><span class="stat-label">Medium Severity</span>
                        </div>
                        <div class="stat-item">
                          <span class="stat-value"
                            >{{
                            formatNumber(analysisDetail.summary.low_severity)
                            }}</span
                          ><span class="stat-label">Low Severity</span>
                        </div>
                      </div>
                      <div
                        v-if="analysisDetail.vulnerabilities.length === 0"
                        class="empty-state success-state"
                      >
                        No security vulnerabilities detected!
                      </div>
                      <div v-else class="analysis-table">
                        <div class="table-header">
                          <span>Function</span><span>File</span
                          ><span>Vulnerability</span><span>Severity</span>
                        </div>
                        <div
                          v-for="(vuln, idx) in analysisDetail.vulnerabilities"
                          :key="idx"
                          class="table-row"
                          :class="'severity-' + vuln.severity"
                          @click="navigateToFunctionById(vuln)"
                        >
                          <span class="fn-name">{{ vuln.symbol }}</span>
                          <span class="fn-file"
                            >{{ vuln.filename }}:{{ vuln.start_line }}</span
                          >
                          <span class="vuln-name"
                            >{{ vuln.vulnerability_name }}</span
                          >
                          <span class="severity-badge" :class="vuln.severity"
                            >{{ vuln.severity }}</span
                          >
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Code Smells Tab -->
                  <div
                    v-if="analysisTab === 'code-smells'"
                    class="analysis-content"
                  >
                    <div v-if="loadingAnalysisDetail" class="loading-container">
                      <div class="loading-spinner"></div>
                      <div class="loading-text">
                        Loading code smell analysis...
                      </div>
                    </div>
                    <div
                      v-else-if="!analysisDetail"
                      class="empty-state-container"
                    >
                      <div class="empty-state-icon">&#128683;</div>
                      <div class="empty-state-title">No Data Available</div>
                      <div class="empty-state-message">
                        Unable to load code smell analysis. Please try again.
                      </div>
                    </div>
                    <div v-else>
                      <div class="analysis-stats-bar">
                        <div class="stat-item">
                          <span class="stat-value"
                            >{{
                            formatNumber(analysisDetail.summary.total_smells)
                            }}</span
                          ><span class="stat-label">Total Smells</span>
                        </div>
                        <div class="stat-item">
                          <span class="stat-value"
                            >{{ analysisDetail.summary.smell_density }}%</span
                          ><span class="stat-label">Smell Density</span>
                        </div>
                        <div class="stat-item">
                          <span class="stat-value"
                            >{{
                            formatNumber(analysisDetail.summary.god_functions)
                            }}</span
                          ><span class="stat-label">God Functions</span>
                        </div>
                      </div>
                      <div
                        v-if="analysisDetail.summary.total_smells === 0"
                        class="empty-state success-state"
                      >
                        No code smells detected!
                      </div>
                      <div v-else>
                        <div
                          v-if="analysisDetail.smells.long_methods.length > 0"
                        >
                          <h3>Long Methods (>50 lines)</h3>
                          <div class="analysis-table">
                            <div class="table-header">
                              <span>Function</span><span>File</span
                              ><span>Lines</span>
                            </div>
                            <div
                              v-for="fn in analysisDetail.smells.long_methods"
                              :key="fn.id"
                              class="table-row"
                              @click="navigateToFunctionById(fn)"
                            >
                              <span class="fn-name">{{ fn.symbol }}</span>
                              <span class="fn-file"
                                >{{ fn.filename }}:{{ fn.start_line }}</span
                              >
                              <span>{{ fn.lines }}</span>
                            </div>
                          </div>
                        </div>
                        <div
                          v-if="analysisDetail.smells.high_complexity.length > 0"
                        >
                          <h3>High Complexity (>15)</h3>
                          <div class="analysis-table">
                            <div class="table-header">
                              <span>Function</span><span>File</span
                              ><span>Cyclomatic</span>
                            </div>
                            <div
                              v-for="fn in analysisDetail.smells.high_complexity"
                              :key="fn.id"
                              class="table-row"
                              @click="navigateToFunctionById(fn)"
                            >
                              <span class="fn-name">{{ fn.symbol }}</span>
                              <span class="fn-file"
                                >{{ fn.filename }}:{{ fn.start_line }}</span
                              >
                              <span>{{ fn.cyclomatic }}</span>
                            </div>
                          </div>
                        </div>
                        <div
                          v-if="analysisDetail.smells.long_parameter_lists.length > 0"
                        >
                          <h3>Long Parameter Lists (>5)</h3>
                          <div class="analysis-table">
                            <div class="table-header">
                              <span>Function</span><span>File</span
                              ><span>Parameters</span>
                            </div>
                            <div
                              v-for="fn in analysisDetail.smells.long_parameter_lists"
                              :key="fn.id"
                              class="table-row"
                              @click="navigateToFunctionById(fn)"
                            >
                              <span class="fn-name">{{ fn.symbol }}</span>
                              <span class="fn-file"
                                >{{ fn.filename }}:{{ fn.start_line }}</span
                              >
                              <span>{{ fn.parameter_count }}</span>
                            </div>
                          </div>
                        </div>
                        <div
                          v-if="analysisDetail.smells.deep_nesting.length > 0"
                        >
                          <h3>Deep Nesting (>4 levels)</h3>
                          <div class="analysis-table">
                            <div class="table-header">
                              <span>Function</span><span>File</span
                              ><span>Depth</span>
                            </div>
                            <div
                              v-for="fn in analysisDetail.smells.deep_nesting"
                              :key="fn.id"
                              class="table-row"
                              @click="navigateToFunctionById(fn)"
                            >
                              <span class="fn-name">{{ fn.symbol }}</span>
                              <span class="fn-file"
                                >{{ fn.filename }}:{{ fn.start_line }}</span
                              >
                              <span>{{ fn.nesting_depth }}</span>
                            </div>
                          </div>
                        </div>
                        <div
                          v-if="analysisDetail.smells.god_functions && analysisDetail.smells.god_functions.length > 0"
                        >
                          <h3>God Functions (>200 lines)</h3>
                          <div class="analysis-table">
                            <div class="table-header">
                              <span>Function</span><span>File</span
                              ><span>Lines</span>
                            </div>
                            <div
                              v-for="fn in analysisDetail.smells.god_functions"
                              :key="fn.id"
                              class="table-row"
                              @click="navigateToFunctionById(fn)"
                            >
                              <span class="fn-name">{{ fn.symbol }}</span>
                              <span class="fn-file"
                                >{{ fn.filename }}:{{ fn.start_line }}</span
                              >
                              <span>{{ fn.lines }}</span>
                            </div>
                          </div>
                        </div>
                        <div
                          v-if="analysisDetail.smells.duplicate_code_suspects && analysisDetail.smells.duplicate_code_suspects.length > 0"
                        >
                          <h3>Duplicate Code Suspects</h3>
                          <div class="analysis-table">
                            <div class="table-header">
                              <span>Base Name</span><span>Occurrences</span
                              ><span>Severity</span>
                            </div>
                            <div
                              v-for="(dup, idx) in analysisDetail.smells.duplicate_code_suspects"
                              :key="idx"
                              class="table-row"
                            >
                              <span class="fn-name">{{ dup.base_name }}*</span>
                              <span>{{ dup.occurrence_count }}</span>
                              <span class="severity-badge" :class="dup.severity"
                                >{{ dup.severity }}</span
                              >
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Types Tab -->
                  <div v-if="analysisTab === 'types'" class="analysis-content">
                    <div v-if="loadingAnalysisDetail" class="loading-container">
                      <div class="loading-spinner"></div>
                      <div class="loading-text">Loading type analysis...</div>
                    </div>
                    <div
                      v-else-if="!analysisDetail"
                      class="empty-state-container"
                    >
                      <div class="empty-state-icon">T</div>
                      <div class="empty-state-title">No Data Available</div>
                      <div class="empty-state-message">
                        Unable to load type analysis. Please try again.
                      </div>
                    </div>
                    <div v-else>
                      <div class="analysis-stats-bar">
                        <div class="stat-item">
                          <span class="stat-value"
                            >{{
                            formatNumber(analysisDetail.summary.total_dynamic_functions)
                            }}</span
                          ><span class="stat-label">Dynamic Functions</span>
                        </div>
                        <div class="stat-item">
                          <span class="stat-value"
                            >{{
                            formatNumber(analysisDetail.summary.with_type_hints)
                            }}</span
                          ><span class="stat-label">With Types</span>
                        </div>
                        <div class="stat-item">
                          <span class="stat-value"
                            >{{ analysisDetail.summary.type_coverage_percentage
                            }}%</span
                          ><span class="stat-label">Type Coverage</span>
                        </div>
                      </div>
                      <div
                        v-if="analysisDetail.summary.total_dynamic_functions === 0"
                        class="empty-state"
                      >
                        No dynamically-typed functions to analyze.
                      </div>
                      <div v-else>
                        <h3>Functions Without Type Hints</h3>
                        <div
                          v-if="analysisDetail.functions_without_type_hints.length === 0"
                          class="empty-state success-state"
                        >
                          All functions have type hints!
                        </div>
                        <div v-else class="analysis-table">
                          <div class="table-header">
                            <span>Function</span><span>File</span
                            ><span>Inferred Type</span>
                          </div>
                          <div
                            v-for="fn in analysisDetail.functions_without_type_hints.slice(0, 30)"
                            :key="fn.id"
                            class="table-row"
                            @click="navigateToFunctionById(fn)"
                          >
                            <span class="fn-name">{{ fn.symbol }}</span>
                            <span class="fn-file"
                              >{{ fn.filename }}:{{ fn.start_line }}</span
                            >
                            <span class="type-inferred"
                              >{{ fn.inferred_return_type }}</span
                            >
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- API Surface Tab -->
                  <div
                    v-if="analysisTab === 'api-surface'"
                    class="analysis-content"
                  >
                    <div v-if="loadingAnalysisDetail" class="loading-container">
                      <div class="loading-spinner"></div>
                      <div class="loading-text">
                        Loading API surface analysis...
                      </div>
                    </div>
                    <div
                      v-else-if="!analysisDetail"
                      class="empty-state-container"
                    >
                      <div class="empty-state-icon">&#128268;</div>
                      <div class="empty-state-title">No Data Available</div>
                      <div class="empty-state-message">
                        Unable to load API surface analysis. Please try again.
                      </div>
                    </div>
                    <div v-else>
                      <div class="analysis-stats-bar">
                        <div class="stat-item">
                          <span class="stat-value"
                            >{{
                            formatNumber(analysisDetail.summary.public_count)
                            }}</span
                          ><span class="stat-label">Public Functions</span>
                        </div>
                        <div class="stat-item">
                          <span class="stat-value"
                            >{{
                            formatNumber(analysisDetail.summary.private_count)
                            }}</span
                          ><span class="stat-label">Private Functions</span>
                        </div>
                        <div class="stat-item">
                          <span class="stat-value"
                            >{{ analysisDetail.summary.documentation_coverage
                            }}%</span
                          ><span class="stat-label">API Doc Coverage</span>
                        </div>
                      </div>
                      <div v-if="analysisDetail.undocumented_public.length > 0">
                        <h3>Undocumented Public Functions</h3>
                        <div class="analysis-table">
                          <div class="table-header">
                            <span>Function</span><span>File</span
                            ><span>Callers</span>
                          </div>
                          <div
                            v-for="fn in analysisDetail.undocumented_public.slice(0, 20)"
                            :key="fn.id"
                            class="table-row"
                            @click="navigateToFunctionById(fn)"
                          >
                            <span class="fn-name">{{ fn.symbol }}</span>
                            <span class="fn-file"
                              >{{ fn.filename }}:{{ fn.start_line }}</span
                            >
                            <span>{{ fn.caller_count }}</span>
                          </div>
                        </div>
                      </div>
                      <h3>Entry Points</h3>
                      <div
                        v-if="analysisDetail.entry_points.length === 0"
                        class="empty-state"
                      >
                        No obvious entry points detected.
                      </div>
                      <div v-else class="analysis-table">
                        <div class="table-header">
                          <span>Function</span><span>File</span
                          ><span>Callers</span>
                        </div>
                        <div
                          v-for="fn in analysisDetail.entry_points"
                          :key="fn.id"
                          class="table-row"
                          @click="navigateToFunctionById(fn)"
                        >
                          <span class="fn-name">{{ fn.symbol }}</span>
                          <span class="fn-file"
                            >{{ fn.filename }}:{{ fn.start_line }}</span
                          >
                          <span>{{ fn.caller_count }}</span>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Documentation Tab -->
                  <div
                    v-if="analysisTab === 'documentation'"
                    class="analysis-content"
                  >
                    <div v-if="loadingAnalysisDetail" class="loading-container">
                      <div class="loading-spinner"></div>
                      <div class="loading-text">
                        Loading documentation analysis...
                      </div>
                    </div>
                    <div
                      v-else-if="!analysisDetail"
                      class="empty-state-container"
                    >
                      <div class="empty-state-icon">&#128196;</div>
                      <div class="empty-state-title">No Data Available</div>
                      <div class="empty-state-message">
                        Unable to load documentation analysis. Please try again.
                      </div>
                    </div>
                    <div v-else>
                      <div class="analysis-stats-bar">
                        <div class="stat-item">
                          <span class="stat-value"
                            >{{ analysisDetail.summary.coverage_percentage
                            }}%</span
                          ><span class="stat-label">Doc Coverage</span>
                        </div>
                        <div class="stat-item">
                          <span class="stat-value"
                            >{{
                            formatNumber(analysisDetail.summary.fully_documented)
                            }}</span
                          ><span class="stat-label">Documented</span>
                        </div>
                        <div class="stat-item">
                          <span class="stat-value"
                            >{{
                            formatNumber(analysisDetail.summary.undocumented)
                            }}</span
                          ><span class="stat-label">Undocumented</span>
                        </div>
                      </div>
                      <h3>Documentation by File</h3>
                      <div class="analysis-table">
                        <div class="table-header">
                          <span>File</span><span>Documented</span
                          ><span>Total</span><span>Coverage</span>
                        </div>
                        <div
                          v-for="file in analysisDetail.by_file.slice(0, 20)"
                          :key="file.filename"
                          class="table-row"
                          :class="{ 'warning-row': file.coverage < 50 }"
                        >
                          <span class="fn-file">{{ file.filename }}</span>
                          <span>{{ file.documented }}</span>
                          <span>{{ file.total }}</span>
                          <span :class="{ 'low-coverage': file.coverage < 50 }"
                            >{{ file.coverage }}%</span
                          >
                        </div>
                      </div>
                      <div v-if="analysisDetail.undocumented.length > 0">
                        <h3>Undocumented Functions</h3>
                        <div class="analysis-table">
                          <div class="table-header">
                            <span>Function</span><span>File</span>
                          </div>
                          <div
                            v-for="fn in analysisDetail.undocumented.slice(0, 30)"
                            :key="fn.id"
                            class="table-row"
                            @click="navigateToFunctionById(fn)"
                          >
                            <span class="fn-name">{{ fn.symbol }}</span>
                            <span class="fn-file"
                              >{{ fn.filename }}:{{ fn.start_line }}</span
                            >
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Variable Scope Tab -->
                  <div v-if="analysisTab === 'scope'" class="analysis-content">
                    <div v-if="loadingAnalysisDetail" class="loading-container">
                      <div class="loading-spinner"></div>
                      <div class="loading-text">Loading scope analysis...</div>
                    </div>
                    <div
                      v-else-if="!analysisDetail"
                      class="empty-state-container"
                    >
                      <div class="empty-state-icon">&#128269;</div>
                      <div class="empty-state-title">No Data Available</div>
                      <div class="empty-state-message">
                        Unable to load scope analysis. Please try again.
                      </div>
                    </div>
                    <div v-else>
                      <div class="analysis-stats-bar">
                        <div class="stat-item">
                          <span class="stat-value"
                            >{{
                            formatNumber(analysisDetail.summary.total_issues)
                            }}</span
                          ><span class="stat-label">Total Issues</span>
                        </div>
                        <div class="stat-item">
                          <span class="stat-value"
                            >{{
                            formatNumber(analysisDetail.summary.global_variable_issues)
                            }}</span
                          ><span class="stat-label">Global Vars</span>
                        </div>
                        <div class="stat-item">
                          <span class="stat-value"
                            >{{
                            formatNumber(analysisDetail.summary.shadowing_issues)
                            }}</span
                          ><span class="stat-label">Shadowing</span>
                        </div>
                      </div>
                      <div
                        v-if="analysisDetail.summary.total_issues === 0"
                        class="empty-state success-state"
                      >
                        No variable scope issues detected!
                      </div>
                      <div v-else>
                        <div
                          v-if="analysisDetail.issues.global_variables.length > 0"
                        >
                          <h3>Global Variable Usage</h3>
                          <div class="analysis-table">
                            <div class="table-header">
                              <span>Function</span><span>File</span>
                            </div>
                            <div
                              v-for="fn in analysisDetail.issues.global_variables"
                              :key="fn.id"
                              class="table-row"
                              @click="navigateToFunctionById(fn)"
                            >
                              <span class="fn-name">{{ fn.symbol }}</span>
                              <span class="fn-file"
                                >{{ fn.filename }}:{{ fn.start_line }}</span
                              >
                            </div>
                          </div>
                        </div>
                        <div
                          v-if="analysisDetail.issues.variable_shadowing.length > 0"
                        >
                          <h3>Variable Shadowing</h3>
                          <div class="analysis-table">
                            <div class="table-header">
                              <span>Function</span><span>File</span
                              ><span>Variable</span>
                            </div>
                            <div
                              v-for="(issue, idx) in analysisDetail.issues.variable_shadowing"
                              :key="idx"
                              class="table-row"
                              @click="navigateToFunctionById(issue)"
                            >
                              <span class="fn-name">{{ issue.symbol }}</span>
                              <span class="fn-file"
                                >{{ issue.filename }}:{{ issue.start_line
                                }}</span
                              >
                              <span>{{ issue.variable }}</span>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Concurrency Tab (On-demand) -->
                  <div
                    v-if="analysisTab === 'concurrency'"
                    class="analysis-content"
                  >
                    <div v-if="loadingAnalysisDetail" class="loading-container">
                      <div class="loading-spinner"></div>
                      <div class="loading-text">
                        Analyzing concurrency patterns...
                      </div>
                      <div class="loading-subtext">
                        Scanning for async/await, threads, and synchronization
                        primitives
                      </div>
                    </div>
                    <div
                      v-else-if="!analysisDetail"
                      class="empty-state-container"
                    >
                      <div class="empty-state-icon">||</div>
                      <div class="empty-state-title">No Data Available</div>
                      <div class="empty-state-message">
                        Unable to load concurrency analysis. Please try again.
                      </div>
                    </div>
                    <div
                      v-else-if="analysisDetail.summary.functions_with_concurrency === 0"
                      class="empty-state-container"
                    >
                      <div class="empty-state-icon success">&#10003;</div>
                      <div class="empty-state-title">
                        No Concurrency Patterns Found
                      </div>
                      <div class="empty-state-message">
                        This project doesn't appear to use concurrency features
                        like async/await, threads, or synchronization
                        primitives.
                      </div>
                    </div>
                    <div v-else>
                      <div class="analysis-stats-bar">
                        <div class="stat-item">
                          <span class="stat-value"
                            >{{
                            formatNumber(analysisDetail.summary.functions_with_concurrency)
                            }}</span
                          ><span class="stat-label">Functions</span>
                        </div>
                        <div class="stat-item">
                          <span class="stat-value"
                            >{{
                            formatNumber(analysisDetail.summary.total_async_patterns)
                            }}</span
                          ><span class="stat-label">Async/Await</span>
                        </div>
                        <div class="stat-item">
                          <span class="stat-value"
                            >{{
                            formatNumber(analysisDetail.summary.total_thread_patterns)
                            }}</span
                          ><span class="stat-label">Thread Patterns</span>
                        </div>
                        <div class="stat-item">
                          <span class="stat-value"
                            >{{
                            formatNumber(analysisDetail.summary.total_sync_patterns)
                            }}</span
                          ><span class="stat-label">Sync Primitives</span>
                        </div>
                        <div
                          class="stat-item"
                          :class="{ 'stat-warning': analysisDetail.summary.total_warnings > 0 }"
                        >
                          <span class="stat-value"
                            >{{
                            formatNumber(analysisDetail.summary.total_warnings)
                            }}</span
                          ><span class="stat-label">Warnings</span>
                        </div>
                      </div>

                      <!-- Warnings -->
                      <div
                        v-if="analysisDetail.warnings && analysisDetail.warnings.length > 0"
                        class="pattern-section"
                      >
                        <h3>Concurrency Warnings</h3>
                        <div class="analysis-table">
                          <div class="table-header">
                            <span>Function</span><span>File</span
                            ><span>Warning</span>
                          </div>
                          <div
                            v-for="(warn, idx) in analysisDetail.warnings.slice(0, 10)"
                            :key="idx"
                            class="table-row warning-row"
                            @click="navigateToFunctionById(warn)"
                          >
                            <span class="fn-name">{{ warn.symbol }}</span>
                            <span class="fn-file"
                              >{{ warn.filename }}:{{ warn.start_line }}</span
                            >
                            <span>{{ warn.description }}</span>
                          </div>
                          <div
                            v-if="analysisDetail.warnings.length > 10"
                            class="table-more"
                          >
                            And {{ analysisDetail.warnings.length - 10 }}
                            more...
                          </div>
                        </div>
                      </div>

                      <!-- Async/Await Patterns -->
                      <div
                        v-if="analysisDetail.async_patterns_grouped && analysisDetail.async_patterns_grouped.length > 0"
                        class="pattern-section"
                      >
                        <h3>Async/Await Patterns</h3>
                        <div
                          v-for="group in analysisDetail.async_patterns_grouped"
                          :key="group.type"
                          class="pattern-group"
                        >
                          <div class="pattern-group-header">
                            <span class="pattern-type-badge async"
                              >{{ group.type }}</span
                            >
                            <span class="pattern-count"
                              >{{ group.count }} occurrences</span
                            >
                          </div>
                          <div class="analysis-table">
                            <div class="table-header">
                              <span>Function</span><span>File</span
                              ><span>Line</span>
                            </div>
                            <div
                              v-for="(loc, idx) in group.locations.slice(0, 10)"
                              :key="idx"
                              class="table-row"
                              @click="navigateToFunctionById(loc)"
                            >
                              <span class="fn-name">{{ loc.symbol }}</span>
                              <span class="fn-file">{{ loc.filename }}</span>
                              <span>{{ loc.line }}</span>
                            </div>
                            <div
                              v-if="group.locations.length > 10"
                              class="table-more"
                            >
                              And {{ group.locations.length - 10 }} more...
                            </div>
                          </div>
                        </div>
                      </div>

                      <!-- Thread Patterns -->
                      <div
                        v-if="analysisDetail.thread_patterns_grouped && analysisDetail.thread_patterns_grouped.length > 0"
                        class="pattern-section"
                      >
                        <h3>Thread Patterns</h3>
                        <div
                          v-for="group in analysisDetail.thread_patterns_grouped"
                          :key="group.type"
                          class="pattern-group"
                        >
                          <div class="pattern-group-header">
                            <span class="pattern-type-badge thread"
                              >{{ group.type }}</span
                            >
                            <span class="pattern-count"
                              >{{ group.count }} occurrences</span
                            >
                          </div>
                          <div class="analysis-table">
                            <div class="table-header">
                              <span>Function</span><span>File</span
                              ><span>Line</span>
                            </div>
                            <div
                              v-for="(loc, idx) in group.locations.slice(0, 10)"
                              :key="idx"
                              class="table-row"
                              @click="navigateToFunctionById(loc)"
                            >
                              <span class="fn-name">{{ loc.symbol }}</span>
                              <span class="fn-file">{{ loc.filename }}</span>
                              <span>{{ loc.line }}</span>
                            </div>
                            <div
                              v-if="group.locations.length > 10"
                              class="table-more"
                            >
                              And {{ group.locations.length - 10 }} more...
                            </div>
                          </div>
                        </div>
                      </div>

                      <!-- Synchronization Patterns -->
                      <div
                        v-if="analysisDetail.sync_patterns_grouped && analysisDetail.sync_patterns_grouped.length > 0"
                        class="pattern-section"
                      >
                        <h3>Synchronization Patterns</h3>
                        <div
                          v-for="group in analysisDetail.sync_patterns_grouped"
                          :key="group.type"
                          class="pattern-group"
                        >
                          <div class="pattern-group-header">
                            <span class="pattern-type-badge sync"
                              >{{ group.type }}</span
                            >
                            <span class="pattern-count"
                              >{{ group.count }} occurrences</span
                            >
                          </div>
                          <div class="analysis-table">
                            <div class="table-header">
                              <span>Function</span><span>File</span
                              ><span>Line</span>
                            </div>
                            <div
                              v-for="(loc, idx) in group.locations.slice(0, 10)"
                              :key="idx"
                              class="table-row"
                              @click="navigateToFunctionById(loc)"
                            >
                              <span class="fn-name">{{ loc.symbol }}</span>
                              <span class="fn-file">{{ loc.filename }}</span>
                              <span>{{ loc.line }}</span>
                            </div>
                            <div
                              v-if="group.locations.length > 10"
                              class="table-more"
                            >
                              And {{ group.locations.length - 10 }} more...
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Resources Tab (On-demand) -->
                  <div
                    v-if="analysisTab === 'resources'"
                    class="analysis-content"
                  >
                    <div v-if="loadingAnalysisDetail" class="loading-container">
                      <div class="loading-spinner"></div>
                      <div class="loading-text">
                        Analyzing resource patterns...
                      </div>
                      <div class="loading-subtext">
                        Scanning for memory allocations, file handles, and
                        potential leaks
                      </div>
                    </div>
                    <div
                      v-else-if="!analysisDetail"
                      class="empty-state-container"
                    >
                      <div class="empty-state-icon">R</div>
                      <div class="empty-state-title">No Data Available</div>
                      <div class="empty-state-message">
                        Unable to load resource analysis. Please try again.
                      </div>
                    </div>
                    <div
                      v-else-if="analysisDetail.summary.functions_with_resources === 0"
                      class="empty-state-container"
                    >
                      <div class="empty-state-icon success">&#10003;</div>
                      <div class="empty-state-title">
                        No Resource Patterns Found
                      </div>
                      <div class="empty-state-message">
                        This project doesn't appear to use manual resource
                        management patterns like memory allocation or file
                        handles.
                      </div>
                    </div>
                    <div v-else>
                      <div class="analysis-stats-bar">
                        <div class="stat-item">
                          <span class="stat-value"
                            >{{
                            formatNumber(analysisDetail.summary.functions_with_resources)
                            }}</span
                          ><span class="stat-label">Functions</span>
                        </div>
                        <div class="stat-item">
                          <span class="stat-value"
                            >{{
                            formatNumber(analysisDetail.summary.total_acquisitions)
                            }}</span
                          ><span class="stat-label">Acquisitions</span>
                        </div>
                        <div class="stat-item">
                          <span class="stat-value"
                            >{{
                            formatNumber(analysisDetail.summary.total_releases)
                            }}</span
                          ><span class="stat-label">Releases</span>
                        </div>
                        <div
                          class="stat-item"
                          :class="{ 'stat-warning': analysisDetail.summary.total_potential_leaks > 0 }"
                        >
                          <span class="stat-value"
                            >{{
                            formatNumber(analysisDetail.summary.total_potential_leaks)
                            }}</span
                          ><span class="stat-label">Potential Leaks</span>
                        </div>
                        <div
                          class="stat-item"
                          :class="{ 'stat-warning': analysisDetail.summary.total_warnings > 0 }"
                        >
                          <span class="stat-value"
                            >{{
                            formatNumber(analysisDetail.summary.total_warnings)
                            }}</span
                          ><span class="stat-label">Warnings</span>
                        </div>
                      </div>

                      <!-- Potential Leaks -->
                      <div
                        v-if="analysisDetail.potential_leaks_grouped && analysisDetail.potential_leaks_grouped.length > 0"
                        class="pattern-section"
                      >
                        <h3>Potential Resource Leaks</h3>
                        <div
                          v-for="group in analysisDetail.potential_leaks_grouped"
                          :key="group.name"
                          class="pattern-group warning-group"
                        >
                          <div class="pattern-group-header">
                            <span class="pattern-type-badge leak"
                              >{{ group.name }}</span
                            >
                            <span class="pattern-count"
                              >{{ group.count }} occurrences</span
                            >
                          </div>
                          <div
                            v-if="group.description"
                            class="pattern-description"
                          >
                            {{ group.description }}
                          </div>
                          <div class="analysis-table">
                            <div class="table-header">
                              <span>Function</span><span>File</span
                              ><span>Line</span>
                            </div>
                            <div
                              v-for="(loc, idx) in group.locations.slice(0, 10)"
                              :key="idx"
                              class="table-row warning-row"
                              @click="navigateToFunctionById(loc)"
                            >
                              <span class="fn-name">{{ loc.symbol }}</span>
                              <span class="fn-file">{{ loc.filename }}</span>
                              <span>{{ loc.line }}</span>
                            </div>
                            <div
                              v-if="group.locations.length > 10"
                              class="table-more"
                            >
                              And {{ group.locations.length - 10 }} more...
                            </div>
                          </div>
                        </div>
                      </div>

                      <!-- Warnings -->
                      <div
                        v-if="analysisDetail.warnings && analysisDetail.warnings.length > 0"
                        class="pattern-section"
                      >
                        <h3>Resource Warnings</h3>
                        <div class="analysis-table">
                          <div class="table-header">
                            <span>Function</span><span>File</span
                            ><span>Warning</span>
                          </div>
                          <div
                            v-for="(warn, idx) in analysisDetail.warnings.slice(0, 10)"
                            :key="idx"
                            class="table-row warning-row"
                            @click="navigateToFunctionById(warn)"
                          >
                            <span class="fn-name">{{ warn.symbol }}</span>
                            <span class="fn-file"
                              >{{ warn.filename }}:{{ warn.start_line }}</span
                            >
                            <span>{{ warn.description }}</span>
                          </div>
                          <div
                            v-if="analysisDetail.warnings.length > 10"
                            class="table-more"
                          >
                            And {{ analysisDetail.warnings.length - 10 }}
                            more...
                          </div>
                        </div>
                      </div>

                      <!-- Releases -->
                      <div
                        v-if="analysisDetail.releases_grouped && analysisDetail.releases_grouped.length > 0"
                        class="pattern-section"
                      >
                        <h3>Resource Releases</h3>
                        <div
                          v-for="group in analysisDetail.releases_grouped"
                          :key="group.name"
                          class="pattern-group"
                        >
                          <div class="pattern-group-header">
                            <span class="pattern-type-badge release"
                              >{{ group.name }}</span
                            >
                            <span class="pattern-count"
                              >{{ group.count }} occurrences</span
                            >
                          </div>
                          <div class="analysis-table">
                            <div class="table-header">
                              <span>Function</span><span>File</span
                              ><span>Line</span>
                            </div>
                            <div
                              v-for="(loc, idx) in group.locations.slice(0, 10)"
                              :key="idx"
                              class="table-row"
                              @click="navigateToFunctionById(loc)"
                            >
                              <span class="fn-name">{{ loc.symbol }}</span>
                              <span class="fn-file">{{ loc.filename }}</span>
                              <span>{{ loc.line }}</span>
                            </div>
                            <div
                              v-if="group.locations.length > 10"
                              class="table-more"
                            >
                              And {{ group.locations.length - 10 }} more...
                            </div>
                          </div>
                        </div>
                      </div>

                      <!-- Acquisitions -->
                      <div
                        v-if="analysisDetail.acquisitions_grouped && analysisDetail.acquisitions_grouped.length > 0"
                        class="pattern-section"
                      >
                        <h3>Resource Acquisitions</h3>
                        <div
                          v-for="group in analysisDetail.acquisitions_grouped"
                          :key="group.name"
                          class="pattern-group"
                        >
                          <div class="pattern-group-header">
                            <span class="pattern-type-badge alloc"
                              >{{ group.name }}</span
                            >
                            <span class="pattern-count"
                              >{{ group.count }} occurrences</span
                            >
                          </div>
                          <div class="analysis-table">
                            <div class="table-header">
                              <span>Function</span><span>File</span
                              ><span>Line</span>
                            </div>
                            <div
                              v-for="(loc, idx) in group.locations.slice(0, 10)"
                              :key="idx"
                              class="table-row"
                              @click="navigateToFunctionById(loc)"
                            >
                              <span class="fn-name">{{ loc.symbol }}</span>
                              <span class="fn-file">{{ loc.filename }}</span>
                              <span>{{ loc.line }}</span>
                            </div>
                            <div
                              v-if="group.locations.length > 10"
                              class="table-more"
                            >
                              And {{ group.locations.length - 10 }} more...
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Patterns Tab (On-demand) -->
                  <div
                    v-if="analysisTab === 'patterns'"
                    class="analysis-content"
                  >
                    <div v-if="loadingAnalysisDetail" class="loading-container">
                      <div class="loading-spinner"></div>
                      <div class="loading-text">
                        Analyzing design patterns...
                      </div>
                      <div class="loading-subtext">
                        Detecting Singleton, Factory, Observer, and other
                        patterns
                      </div>
                    </div>
                    <div
                      v-else-if="!analysisDetail"
                      class="empty-state-container"
                    >
                      <div class="empty-state-icon">P</div>
                      <div class="empty-state-title">No Data Available</div>
                      <div class="empty-state-message">
                        Unable to load pattern analysis. Please try again.
                      </div>
                    </div>
                    <div
                      v-else-if="analysisDetail.summary.total_patterns_detected === 0 && (!analysisDetail.anti_patterns || analysisDetail.anti_patterns.length === 0)"
                      class="empty-state-container"
                    >
                      <div class="empty-state-icon">P</div>
                      <div class="empty-state-title">No Patterns Detected</div>
                      <div class="empty-state-message">
                        No common design patterns or anti-patterns were detected
                        in this project.
                      </div>
                    </div>
                    <div v-else>
                      <div class="analysis-stats-bar">
                        <div class="stat-item">
                          <span class="stat-value"
                            >{{
                            formatNumber(analysisDetail.summary.total_patterns_detected)
                            }}</span
                          ><span class="stat-label">Design Patterns</span>
                        </div>
                        <div class="stat-item">
                          <span class="stat-value"
                            >{{ formatNumber(
                            analysisDetail.summary.patterns_by_category['anti-pattern']
                            || 0) }}</span
                          ><span class="stat-label">Anti-Patterns</span>
                        </div>
                        <div class="stat-item">
                          <span class="stat-value"
                            >{{
                            formatNumber(analysisDetail.summary.total_functions)
                            }}</span
                          ><span class="stat-label">Functions Analyzed</span>
                        </div>
                        <div class="stat-item">
                          <span class="stat-value"
                            >{{ formatNumber(
                            analysisDetail.summary.error_handling.functions_with_error_handling)
                            }}</span
                          ><span class="stat-label">Error Handlers</span>
                        </div>
                      </div>

                      <!-- Design Patterns by Category -->
                      <div
                        v-if="analysisDetail.pattern_locations && analysisDetail.pattern_locations.length > 0"
                        class="pattern-section"
                      >
                        <h3>Design Patterns Detected</h3>
                        <div class="analysis-table">
                          <div class="table-header">
                            <span>Pattern</span><span>File</span
                            ><span>Line</span><span>Context</span>
                          </div>
                          <div
                            v-for="(loc, idx) in analysisDetail.pattern_locations.slice(0, 20)"
                            :key="idx"
                            class="table-row"
                          >
                            <span class="pattern-type-badge pattern"
                              >{{ loc.pattern }}</span
                            >
                            <span class="fn-file">{{ loc.filename }}</span>
                            <span>{{ loc.line }}</span>
                            <span class="pattern-context"
                              >{{ loc.context }}</span
                            >
                          </div>
                          <div
                            v-if="analysisDetail.pattern_locations.length > 20"
                            class="table-more"
                          >
                            And {{ analysisDetail.pattern_locations.length - 20
                            }} more...
                          </div>
                        </div>
                      </div>

                      <!-- Anti-Patterns -->
                      <div
                        v-if="analysisDetail.anti_patterns && analysisDetail.anti_patterns.length > 0"
                        class="pattern-section"
                      >
                        <h3>Anti-Patterns Detected</h3>
                        <div class="analysis-table">
                          <div class="table-header">
                            <span>Anti-Pattern</span><span>File</span
                            ><span>Line</span><span>Context</span>
                          </div>
                          <div
                            v-for="(loc, idx) in analysisDetail.anti_patterns.slice(0, 20)"
                            :key="idx"
                            class="table-row warning-row"
                          >
                            <span class="pattern-type-badge anti-pattern"
                              >{{ loc.pattern }}</span
                            >
                            <span class="fn-file">{{ loc.filename }}</span>
                            <span>{{ loc.line }}</span>
                            <span class="pattern-context"
                              >{{ loc.context }}</span
                            >
                          </div>
                          <div
                            v-if="analysisDetail.anti_patterns.length > 20"
                            class="table-more"
                          >
                            And {{ analysisDetail.anti_patterns.length - 20 }}
                            more...
                          </div>
                        </div>
                      </div>

                      <!-- Error Handling -->
                      <div
                        v-if="analysisDetail.summary.error_handling"
                        class="pattern-section"
                      >
                        <h3>Error Handling Analysis</h3>
                        <div class="analysis-stats-bar">
                          <div class="stat-item">
                            <span class="stat-value"
                              >{{ formatNumber(
                              analysisDetail.summary.error_handling.total_try_catch)
                              }}</span
                            ><span class="stat-label">Try/Catch</span>
                          </div>
                          <div
                            class="stat-item"
                            :class="{ 'stat-warning': analysisDetail.summary.error_handling.total_empty_catch > 0 }"
                          >
                            <span class="stat-value"
                              >{{ formatNumber(
                              analysisDetail.summary.error_handling.total_empty_catch)
                              }}</span
                            ><span class="stat-label">Empty Catch</span>
                          </div>
                          <div class="stat-item">
                            <span class="stat-value"
                              >{{ formatNumber(
                              analysisDetail.summary.error_handling.total_finally)
                              }}</span
                            ><span class="stat-label">Finally Blocks</span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Tests Tab (On-demand) -->
                  <div v-if="analysisTab === 'tests'" class="analysis-content">
                    <div v-if="loadingAnalysisDetail" class="loading-container">
                      <div class="loading-spinner"></div>
                      <div class="loading-text">Analyzing test coverage...</div>
                      <div class="loading-subtext">
                        Scanning for test files, assertions, and mocks
                      </div>
                    </div>
                    <div
                      v-else-if="!analysisDetail"
                      class="empty-state-container"
                    >
                      <div class="empty-state-icon">T</div>
                      <div class="empty-state-title">No Data Available</div>
                      <div class="empty-state-message">
                        Unable to load test analysis. Please try again.
                      </div>
                    </div>
                    <div
                      v-else-if="analysisDetail.summary.test_files === 0"
                      class="empty-state-container"
                    >
                      <div class="empty-state-icon warning">!</div>
                      <div class="empty-state-title">No Test Files Found</div>
                      <div class="empty-state-message">
                        This project doesn't appear to have any test files.
                        Consider adding tests to improve code quality.
                      </div>
                    </div>
                    <div v-else>
                      <div class="analysis-stats-bar">
                        <div class="stat-item">
                          <span class="stat-value"
                            >{{ formatNumber(analysisDetail.summary.test_files)
                            }}</span
                          ><span class="stat-label">Test Files</span>
                        </div>
                        <div class="stat-item">
                          <span class="stat-value"
                            >{{
                            formatNumber(analysisDetail.summary.total_assertions)
                            }}</span
                          ><span class="stat-label">Assertions</span>
                        </div>
                        <div class="stat-item">
                          <span class="stat-value"
                            >{{ formatNumber(analysisDetail.summary.total_mocks)
                            }}</span
                          ><span class="stat-label">Mocks/Stubs</span>
                        </div>
                        <div class="stat-item">
                          <span class="stat-value"
                            >{{ analysisDetail.summary.test_to_code_ratio
                            }}%</span
                          ><span class="stat-label">Test Ratio</span>
                        </div>
                      </div>

                      <!-- Test Files -->
                      <div
                        v-if="analysisDetail.test_files && analysisDetail.test_files.length > 0"
                        class="pattern-section"
                      >
                        <h3>Test Files</h3>
                        <div class="analysis-table">
                          <div class="table-header">
                            <span>File</span><span>Assertions</span
                            ><span>Mocks</span>
                          </div>
                          <div
                            v-for="file in analysisDetail.test_files.slice(0, 20)"
                            :key="file.filename"
                            class="table-row"
                          >
                            <span class="fn-file">{{ file.filename }}</span>
                            <span>{{ file.assertions }}</span>
                            <span>{{ file.mocks }}</span>
                          </div>
                          <div
                            v-if="analysisDetail.test_files.length > 20"
                            class="table-more"
                          >
                            And {{ analysisDetail.test_files.length - 20 }}
                            more...
                          </div>
                        </div>
                      </div>

                      <!-- Coverage Gaps -->
                      <div
                        v-if="analysisDetail.coverage_gaps && analysisDetail.coverage_gaps.length > 0"
                        class="pattern-section"
                      >
                        <h3>Potential Coverage Gaps</h3>
                        <div class="pattern-description">
                          Source files that may not have corresponding test
                          files.
                        </div>
                        <div class="analysis-table">
                          <div class="table-header">
                            <span>Source File</span><span>Message</span>
                          </div>
                          <div
                            v-for="gap in analysisDetail.coverage_gaps.slice(0, 15)"
                            :key="gap.filename"
                            class="table-row warning-row"
                          >
                            <span class="fn-file">{{ gap.filename }}</span>
                            <span>{{ gap.message }}</span>
                          </div>
                          <div
                            v-if="analysisDetail.coverage_gaps.length > 15"
                            class="table-more"
                          >
                            And {{ analysisDetail.coverage_gaps.length - 15 }}
                            more...
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Naming Tab (On-demand) -->
                  <div v-if="analysisTab === 'naming'" class="analysis-content">
                    <div v-if="loadingAnalysisDetail" class="loading-container">
                      <div class="loading-spinner"></div>
                      <div class="loading-text">
                        Analyzing naming conventions...
                      </div>
                      <div class="loading-subtext">
                        Checking camelCase, snake_case, and PascalCase usage
                      </div>
                    </div>
                    <div
                      v-else-if="!analysisDetail"
                      class="empty-state-container"
                    >
                      <div class="empty-state-icon">N</div>
                      <div class="empty-state-title">No Data Available</div>
                      <div class="empty-state-message">
                        Unable to load naming analysis. Please try again.
                      </div>
                    </div>
                    <div v-else>
                      <div class="analysis-stats-bar">
                        <div class="stat-item">
                          <span class="stat-value"
                            >{{
                            formatNumber(analysisDetail.summary.total_identifiers)
                            }}</span
                          ><span class="stat-label">Identifiers</span>
                        </div>
                        <div class="stat-item">
                          <span class="stat-value"
                            >{{ analysisDetail.summary.compliance_rate }}%</span
                          ><span class="stat-label">Compliance</span>
                        </div>
                        <div
                          class="stat-item"
                          :class="{ 'stat-warning': analysisDetail.summary.non_compliant > 0 }"
                        >
                          <span class="stat-value"
                            >{{
                            formatNumber(analysisDetail.summary.non_compliant)
                            }}</span
                          ><span class="stat-label">Violations</span>
                        </div>
                      </div>

                      <!-- Convention Breakdown -->
                      <div
                        v-if="analysisDetail.convention_distribution"
                        class="pattern-section"
                      >
                        <h3>Convention Usage</h3>
                        <div class="naming-conventions-grid">
                          <div
                            v-for="(count, convention) in analysisDetail.convention_distribution"
                            :key="convention"
                            class="naming-convention-card"
                          >
                            <div class="convention-name">{{ convention }}</div>
                            <div class="convention-count">{{ count }}</div>
                          </div>
                        </div>
                      </div>

                      <!-- Violations -->
                      <div
                        v-if="analysisDetail.violations && analysisDetail.violations.length > 0"
                        class="pattern-section"
                      >
                        <h3>Naming Violations</h3>
                        <div class="analysis-table">
                          <div class="table-header">
                            <span>Identifier</span><span>File</span
                            ><span>Expected</span><span>Detected</span>
                          </div>
                          <div
                            v-for="(violation, idx) in analysisDetail.violations.slice(0, 20)"
                            :key="idx"
                            class="table-row warning-row"
                          >
                            <span class="fn-name">{{ violation.symbol }}</span>
                            <span class="fn-file"
                              >{{ violation.filename }}:{{ violation.line
                              }}</span
                            >
                            <span>{{ violation.expected.join(', ') }}</span>
                            <span>{{ violation.detected.join(', ') }}</span>
                          </div>
                          <div
                            v-if="analysisDetail.violations.length > 20"
                            class="table-more"
                          >
                            And {{ analysisDetail.violations.length - 20 }}
                            more...
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Readability Tab (On-demand) -->
                  <div
                    v-if="analysisTab === 'readability'"
                    class="analysis-content"
                  >
                    <div v-if="loadingAnalysisDetail" class="loading-container">
                      <div class="loading-spinner"></div>
                      <div class="loading-text">
                        Calculating readability scores...
                      </div>
                      <div class="loading-subtext">
                        Analyzing code structure, comments, and complexity
                      </div>
                    </div>
                    <div
                      v-else-if="!analysisDetail"
                      class="empty-state-container"
                    >
                      <div class="empty-state-icon">R</div>
                      <div class="empty-state-title">No Data Available</div>
                      <div class="empty-state-message">
                        Unable to load readability analysis. Please try again.
                      </div>
                    </div>
                    <div v-else>
                      <div
                        class="readability-score-card"
                        :class="'readability-' + (analysisDetail.summary.avg_score >= 85 ? 'excellent' : analysisDetail.summary.avg_score >= 70 ? 'good' : analysisDetail.summary.avg_score >= 55 ? 'acceptable' : 'poor')"
                      >
                        <div class="readability-score">
                          {{ analysisDetail.summary.avg_score }}
                        </div>
                        <div class="readability-label">
                          {{ analysisDetail.summary.avg_score >= 85 ?
                          'Excellent' : analysisDetail.summary.avg_score >= 70 ?
                          'Good' : analysisDetail.summary.avg_score >= 55 ?
                          'Acceptable' : 'Poor' }}
                        </div>
                      </div>

                      <div class="analysis-stats-bar">
                        <div class="stat-item">
                          <span class="stat-value"
                            >{{
                            formatNumber(analysisDetail.summary.total_functions)
                            }}</span
                          ><span class="stat-label">Functions</span>
                        </div>
                        <div class="stat-item">
                          <span class="stat-value"
                            >{{
                            formatNumber(analysisDetail.metrics?.avg_line_length
                            || 0) }}</span
                          ><span class="stat-label">Avg Line Length</span>
                        </div>
                        <div class="stat-item">
                          <span class="stat-value"
                            >{{
                            formatNumber(analysisDetail.metrics?.avg_nesting_depth
                            || 0) }}</span
                          ><span class="stat-label">Avg Nesting</span>
                        </div>
                        <div class="stat-item">
                          <span class="stat-value"
                            >{{
                            formatNumber(analysisDetail.metrics?.total_magic_numbers
                            || 0) }}</span
                          ><span class="stat-label">Magic Numbers</span>
                        </div>
                      </div>

                      <!-- Score Distribution -->
                      <div
                        v-if="analysisDetail.summary.score_distribution"
                        class="pattern-section"
                      >
                        <h3>Score Distribution</h3>
                        <div class="naming-conventions-grid">
                          <div class="naming-convention-card">
                            <div class="convention-name">Excellent (85+)</div>
                            <div class="convention-count">
                              {{ formatNumber(
                              analysisDetail.summary.score_distribution.excellent
                              || 0) }}
                            </div>
                          </div>
                          <div class="naming-convention-card">
                            <div class="convention-name">Good (70-84)</div>
                            <div class="convention-count">
                              {{
                              formatNumber(analysisDetail.summary.score_distribution.good
                              || 0) }}
                            </div>
                          </div>
                          <div class="naming-convention-card">
                            <div class="convention-name">
                              Acceptable (55-69)
                            </div>
                            <div class="convention-count">
                              {{ formatNumber(
                              analysisDetail.summary.score_distribution.acceptable
                              || 0) }}
                            </div>
                          </div>
                          <div class="naming-convention-card">
                            <div class="convention-name">Poor (&lt;55)</div>
                            <div class="convention-count">
                              {{
                              formatNumber((analysisDetail.summary.score_distribution.poor
                              || 0) +
                              (analysisDetail.summary.score_distribution.very_poor
                              || 0)) }}
                            </div>
                          </div>
                        </div>
                      </div>

                      <!-- Functions Needing Improvement -->
                      <div
                        v-if="analysisDetail.worst_functions && analysisDetail.worst_functions.length > 0"
                        class="pattern-section"
                      >
                        <h3>Functions Needing Improvement</h3>
                        <div class="analysis-table">
                          <div class="table-header">
                            <span>Function</span><span>File</span
                            ><span>Score</span><span>Rating</span>
                          </div>
                          <div
                            v-for="fn in analysisDetail.worst_functions.slice(0, 15)"
                            :key="fn.symbol + fn.filename"
                            class="table-row"
                            :class="{ 'warning-row': fn.score < 50 }"
                          >
                            <span class="fn-name">{{ fn.symbol }}</span>
                            <span class="fn-file">{{ fn.filename }}</span>
                            <span
                              class="readability-file-score"
                              :class="'score-' + (fn.score >= 70 ? 'good' : fn.score >= 50 ? 'fair' : 'poor')"
                              >{{ fn.score }}</span
                            >
                            <span>{{ fn.rating }}</span>
                          </div>
                          <div
                            v-if="analysisDetail.worst_functions.length > 15"
                            class="table-more"
                          >
                            And {{ analysisDetail.worst_functions.length - 15 }}
                            more...
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Project View (no file or function selected) -->
            <div
              v-if="selectedProject && !selectedFile && !selectedFunction && !showCallGraph && !showJobsView && !showAnalysisView && !showingAllFunctions"
              class="card"
            >
              <h2>Project: {{ selectedProject.name }}</h2>

              <!-- Loading Spinner -->
              <div v-if="loadingProjectInfo" class="loading-container">
                <div class="loading-spinner"></div>
                <div class="loading-text">Loading project information...</div>
              </div>

              <div v-else>
                <div class="detail-section">
                  <h3>Path</h3>
                  <div>{{ projectInfo?.path }}</div>
                </div>

                <!-- Project Complexity Summary -->
                <div v-if="projectInfo?.complexity" class="complexity-card">
                  <h3>Code Complexity</h3>
                  <div class="complexity-grid">
                    <div class="complexity-metric">
                      <div class="value">
                        {{ formatNumber(projectInfo.complexity.total_functions)
                        }}
                      </div>
                      <div class="label">Functions</div>
                    </div>
                    <div class="complexity-metric">
                      <div class="value">
                        {{ formatNumber(projectInfo.complexity.avg_cyclomatic)
                        }}
                      </div>
                      <div class="label">Avg Cyclomatic</div>
                    </div>
                    <div class="complexity-metric">
                      <div class="value">
                        {{ formatNumber(projectInfo.complexity.max_cyclomatic)
                        }}
                      </div>
                      <div class="label">Max Cyclomatic</div>
                    </div>
                    <div class="complexity-metric">
                      <div class="value">
                        {{ formatNumber(projectInfo.complexity.total_loc) }}
                      </div>
                      <div class="label">Total LOC</div>
                    </div>
                    <div class="complexity-metric">
                      <div class="value">
                        {{ formatNumber(projectInfo.complexity.avg_loc) }}
                      </div>
                      <div class="label">Avg LOC</div>
                    </div>
                    <div class="complexity-metric">
                      <div class="value">
                        {{
                        formatNumber(projectInfo.complexity.max_nesting_depth)
                        }}
                      </div>
                      <div class="label">Max Nesting</div>
                    </div>
                  </div>
                  <div
                    v-if="projectInfo.complexity.total_functions > 0"
                    class="complexity-distribution"
                  >
                    <div
                      class="segment segment-low"
                      :style="{ width: getDistributionPercent(projectInfo.complexity, 'low') + '%' }"
                      :title="'Simple: ' + projectInfo.complexity.complexity_distribution.low"
                    ></div>
                    <div
                      class="segment segment-moderate"
                      :style="{ width: getDistributionPercent(projectInfo.complexity, 'moderate') + '%' }"
                      :title="'Moderate: ' + projectInfo.complexity.complexity_distribution.moderate"
                    ></div>
                    <div
                      class="segment segment-high"
                      :style="{ width: getDistributionPercent(projectInfo.complexity, 'high') + '%' }"
                      :title="'Complex: ' + projectInfo.complexity.complexity_distribution.high"
                    ></div>
                    <div
                      class="segment segment-very_high"
                      :style="{ width: getDistributionPercent(projectInfo.complexity, 'very_high') + '%' }"
                      :title="'Very Complex: ' + projectInfo.complexity.complexity_distribution.very_high"
                    ></div>
                  </div>
                </div>

                <!-- Project Actions Menu -->
                <div class="project-actions-grid">
                  <div class="actions-group">
                    <h4>Browse</h4>
                    <div class="actions-list">
                      <button class="action-card" @click="showAllFunctions">
                        <span class="action-icon">&#9776;</span>
                        <span class="action-label">All Entities</span>
                        <span class="action-desc"
                          >Browse all functions, classes, and structs</span
                        >
                      </button>
                    </div>
                  </div>

                  <div class="actions-group">
                    <h4>Visualizations</h4>
                    <div class="actions-list">
                      <button
                        class="action-card"
                        @click="openCallGraph('main')"
                      >
                        <span class="action-icon">&#9673;</span>
                        <span class="action-label">Call Graph</span>
                        <span class="action-desc"
                          >View function call relationships from main</span
                        >
                      </button>
                      <button
                        class="action-card"
                        @click="openCallGraph('main'); switchGraphView('callers')"
                      >
                        <span class="action-icon">&#8593;</span>
                        <span class="action-label">Caller Tree</span>
                        <span class="action-desc"
                          >See what calls a function</span
                        >
                      </button>
                      <button
                        class="action-card"
                        @click="openCallGraph('main'); switchGraphView('callees')"
                      >
                        <span class="action-icon">&#8595;</span>
                        <span class="action-label">Callee Tree</span>
                        <span class="action-desc"
                          >See what a function calls</span
                        >
                      </button>
                    </div>
                  </div>
                </div>
                <div class="detail-section">
                  <h3>
                    Files ({{ formatNumber(projectInfo?.files?.length || 0) }})
                    - Click to view entities
                  </h3>
                  <!-- Directory breadcrumb navigation -->
                  <div v-if="currentDirectory" class="directory-breadcrumb">
                    <span
                      class="breadcrumb-item clickable"
                      @click="navigateToRoot"
                    >
                      <span class="folder-icon">📁</span> Root
                    </span>
                    <template
                      v-for="(part, index) in directoryBreadcrumbs"
                      :key="index"
                    >
                      <span class="breadcrumb-separator">›</span>
                      <span
                        class="breadcrumb-item clickable"
                        @click="navigateToBreadcrumb(index)"
                        >{{ part }}</span
                      >
                    </template>
                  </div>
                  <div class="file-list">
                    <!-- Up directory link -->
                    <div
                      v-if="currentDirectory"
                      class="file-item directory-item"
                      @click="navigateUp"
                    >
                      <span><span class="folder-icon">📁</span> ..</span>
                      <span class="badge">Parent directory</span>
                    </div>
                    <!-- Directories -->
                    <div
                      v-for="dir in directoryContents.directories"
                      :key="'dir-' + dir.name"
                      class="file-item directory-item"
                      @click="navigateToDirectory(dir.name)"
                    >
                      <span
                        ><span class="folder-icon">📁</span> {{ dir.name
                        }}</span
                      >
                      <span class="badge"
                        >{{ formatNumber(dir.fileCount) }} files, {{
                        formatNumber(dir.entityCount) }} entities</span
                      >
                    </div>
                    <!-- Files -->
                    <div
                      v-for="file in directoryContents.files"
                      :key="file.filename"
                      class="file-item"
                      @click="selectFile(file.filename)"
                    >
                      <span
                        >{{ currentDirectory ? file.filename.split('/').pop() :
                        file.filename }}</span
                      >
                      <span class="badge"
                        >{{ formatNumber(file.function_count) }} functions</span
                      >
                    </div>
                  </div>
                </div>
              </div>
              <!-- end v-else for loadingProjectInfo -->
            </div>

            <!-- File View (file selected, no function) -->
            <div
              v-if="selectedFile && !selectedFunction && !showCallGraph && !showAnalysisView"
              class="card"
            >
              <div class="breadcrumb">
                <span class="breadcrumb-item" @click="clearFile"
                  >{{ selectedProject.name }}</span
                >
                <template
                  v-for="(part, idx) in getFilePathParts(selectedFile)"
                  :key="idx"
                >
                  <span class="breadcrumb-separator">›</span>
                  <span
                    class="breadcrumb-item"
                    @click="navigateToFileDirectory(selectedFile, idx)"
                    >{{ part }}</span
                  >
                </template>
                <span class="breadcrumb-separator">›</span>
                <span class="breadcrumb-current"
                  >{{ getFileName(selectedFile) }}</span
                >
              </div>
              <h2>{{ selectedFile.split('/').pop() }}</h2>

              <!-- File Analytics -->
              <div v-if="loadingFileAnalytics" class="loading">
                Loading analytics...
              </div>
              <div
                v-else-if="fileAnalytics?.complexity"
                class="complexity-card"
              >
                <h3>File Complexity</h3>
                <div class="complexity-grid">
                  <div class="complexity-metric">
                    <div class="value">
                      {{ formatNumber(fileAnalytics.entity_count) }}
                    </div>
                    <div class="label">Entities</div>
                  </div>
                  <div class="complexity-metric">
                    <div class="value">
                      {{ formatNumber(fileAnalytics.complexity.total_functions)
                      }}
                    </div>
                    <div class="label">Functions</div>
                  </div>
                  <div class="complexity-metric">
                    <div class="value">
                      {{ fileAnalytics.complexity.avg_cyclomatic }}
                    </div>
                    <div class="label">Avg Cyclomatic</div>
                  </div>
                  <div class="complexity-metric">
                    <div class="value">
                      {{ fileAnalytics.complexity.max_cyclomatic }}
                    </div>
                    <div class="label">Max Cyclomatic</div>
                  </div>
                  <div class="complexity-metric">
                    <div class="value">
                      {{ formatNumber(fileAnalytics.complexity.total_loc) }}
                    </div>
                    <div class="label">Total LOC</div>
                  </div>
                  <div class="complexity-metric">
                    <div class="value">
                      {{ fileAnalytics.complexity.avg_loc }}
                    </div>
                    <div class="label">Avg LOC</div>
                  </div>
                  <div class="complexity-metric">
                    <div class="value">
                      {{ fileAnalytics.complexity.max_nesting_depth }}
                    </div>
                    <div class="label">Max Nesting</div>
                  </div>
                  <div class="complexity-metric">
                    <div class="value">
                      {{ fileAnalytics.complexity.avg_parameters }}
                    </div>
                    <div class="label">Avg Params</div>
                  </div>
                </div>
              </div>

              <!-- Entity Type Breakdown -->
              <div
                v-if="fileAnalytics?.entities_by_type && Object.keys(fileAnalytics.entities_by_type).length > 0"
                class="detail-section"
              >
                <h3>Entity Types</h3>
                <div class="entity-type-breakdown">
                  <span
                    v-for="(count, type) in fileAnalytics.entities_by_type"
                    :key="type"
                    class="entity-type-badge"
                    :class="'type-' + type"
                    >{{ type }}: {{ count }}</span
                  >
                </div>
              </div>

              <!-- Most Complex Functions -->
              <div
                v-if="fileAnalytics?.top_complex?.length > 0"
                class="detail-section"
              >
                <h3>Most Complex Functions</h3>
                <div class="top-complex-list">
                  <div
                    v-for="fn in fileAnalytics.top_complex"
                    :key="fn.id"
                    class="top-complex-item"
                    @click="navigateToFunctionById(fn.id)"
                  >
                    <span class="symbol">{{ fn.symbol }}</span>
                    <span class="metrics">
                      <span
                        class="complexity-badge"
                        :class="'complexity-' + fn.complexity.rating"
                      >
                        {{ fn.complexity.cyclomatic }}
                      </span>
                      Line {{ fn.start_line }}
                    </span>
                  </div>
                </div>
              </div>

              <!-- Entity List -->
              <div class="detail-section">
                <h3>Entities ({{ formatNumber(fileFunctions.length) }})</h3>
                <div v-if="loadingFileFunctions" class="loading">
                  Loading entities...
                </div>
                <div v-else-if="fileFunctions.length > 0" class="function-list">
                  <div
                    v-for="fn in fileFunctions"
                    :key="fn.id"
                    class="function-item"
                    @click="selectFunction(fn)"
                  >
                    <div class="function-name">
                      <span class="entity-type-badge" :class="'type-' + fn.type"
                        >{{ fn.type }}</span
                      >
                      {{ fn.symbol }}{{ fn.parameters || '' }}
                    </div>
                    <div class="function-location">
                      <span
                        class="language-badge"
                        :class="'lang-' + fn.language"
                        >{{ fn.language }}</span
                      >
                      Line {{ fn.start_line }}
                    </div>
                  </div>
                </div>
                <div v-else class="empty-state">No entities in this file</div>
              </div>
            </div>

            <!-- All Functions View -->
            <div
              v-if="showingAllFunctions && !selectedFunction && !showCallGraph && !showAnalysisView"
              class="card"
            >
              <div class="breadcrumb">
                <span class="breadcrumb-item" @click="clearAllFunctions"
                  >{{ selectedProject.name }}</span
                >
                <span class="breadcrumb-separator">›</span>
                <span class="breadcrumb-current">All Entities</span>
              </div>
              <h2>All Entities ({{ formatNumber(allFunctions.length) }})</h2>
              <div v-if="loadingAllFunctions" class="loading">
                Loading entities...
              </div>
              <div
                v-else-if="allFunctions.length > 0"
                class="function-list"
                style="max-height: 600px"
              >
                <div
                  v-for="fn in displayedFunctions"
                  :key="fn.id"
                  class="function-item"
                  @click="selectFunction(fn)"
                >
                  <div class="function-name">
                    <span class="entity-type-badge" :class="'type-' + fn.type"
                      >{{ fn.type }}</span
                    >
                    {{ fn.symbol }}{{ fn.parameters || '' }}
                  </div>
                  <div class="function-location">
                    <span class="language-badge" :class="'lang-' + fn.language"
                      >{{ fn.language }}</span
                    >
                    <span class="clickable-path">
                      <template
                        v-for="(part, idx) in getFilePathParts(fn.filename)"
                        :key="idx"
                      >
                        <span
                          class="path-segment"
                          @click.stop="navigateToFileDirectory(fn.filename, idx)"
                          >{{ part }}</span
                        >/</template
                      ><span class="filename-segment"
                        >{{ getFileName(fn.filename) }}</span
                      ></span
                    >:{{ fn.start_line }}
                  </div>
                </div>
                <!-- Show More / Show All buttons -->
                <div v-if="hasMoreFunctions" class="file-list-more">
                  <button class="btn btn-secondary" @click="showMoreFunctions">
                    Show More ({{ formatNumber(remainingFunctionsCount) }}
                    remaining)
                  </button>
                  <button
                    class="btn btn-link"
                    @click="showAllFunctionsItems"
                    v-if="remainingFunctionsCount > 100"
                  >
                    Show All
                  </button>
                </div>
              </div>
              <div v-else class="empty-state">No entities found</div>
            </div>

            <!-- Function Detail View -->
            <div
              v-if="selectedFunction && !showCallGraph && !showAnalysisView"
              class="card"
            >
              <div class="breadcrumb">
                <span class="breadcrumb-item" @click="clearFunction"
                  >{{ selectedProject?.name || 'Projects' }}</span
                >
                <template v-if="selectedFile">
                  <template
                    v-for="(part, idx) in getFilePathParts(selectedFile)"
                    :key="'bc-'+idx"
                  >
                    <span class="breadcrumb-separator">›</span>
                    <span
                      class="breadcrumb-item"
                      @click="navigateToFileDirectory(selectedFile, idx)"
                      >{{ part }}</span
                    >
                  </template>
                  <span class="breadcrumb-separator">›</span>
                  <span class="breadcrumb-item" @click="backToFile"
                    >{{ getFileName(selectedFile) }}</span
                  >
                </template>
                <span class="breadcrumb-separator">›</span>
                <span class="breadcrumb-current"
                  >{{ selectedFunction.symbol }}</span
                >
              </div>
              <h2>
                {{ selectedFunction.symbol }}{{ selectedFunction.parameters ||
                '' }}
                <span
                  v-if="selectedFunction.complexity"
                  class="complexity-badge"
                  :class="'complexity-' + selectedFunction.complexity.rating"
                >
                  {{ selectedFunction.complexity.label }}
                </span>
              </h2>

              <!-- Function Complexity Metrics -->
              <div v-if="selectedFunction.complexity" class="complexity-card">
                <h3>Complexity Metrics</h3>
                <div class="complexity-grid">
                  <div class="complexity-metric">
                    <div class="value">
                      {{ selectedFunction.complexity.cyclomatic }}
                    </div>
                    <div class="label">Cyclomatic</div>
                  </div>
                  <div class="complexity-metric">
                    <div class="value">
                      {{ selectedFunction.complexity.loc }}
                    </div>
                    <div class="label">Lines of Code</div>
                  </div>
                  <div class="complexity-metric">
                    <div class="value">
                      {{ selectedFunction.complexity.nesting_depth }}
                    </div>
                    <div class="label">Nesting Depth</div>
                  </div>
                  <div class="complexity-metric">
                    <div class="value">
                      {{ selectedFunction.complexity.parameter_count }}
                    </div>
                    <div class="label">Parameters</div>
                  </div>
                </div>
              </div>

              <div class="detail-section">
                <h3>Location</h3>
                <div>
                  <span class="clickable-path">
                    <template
                      v-for="(part, idx) in getFilePathParts(selectedFunction.filename)"
                      :key="idx"
                    >
                      <span
                        class="path-segment"
                        @click="navigateToFileDirectory(selectedFunction.filename, idx)"
                        >{{ part }}</span
                      >/</template
                    ><span class="filename-segment"
                      >{{ getFileName(selectedFunction.filename) }}</span
                    ></span
                  >:{{ selectedFunction.start_line }}-{{
                  selectedFunction.end_line }}
                </div>
              </div>

              <div v-if="selectedFunction.return_type" class="detail-section">
                <h3>Return Type</h3>
                <div class="code-block">{{ selectedFunction.return_type }}</div>
              </div>

              <div v-if="selectedFunction.comment" class="detail-section">
                <h3>Comment</h3>
                <div class="comment-block">{{ selectedFunction.comment }}</div>
              </div>

              <!-- Class/Struct Members Section -->
              <div
                v-if="selectedFunction.type === 'class' || selectedFunction.type === 'struct'"
                class="detail-section"
              >
                <h3>Members ({{ classMembers.length }})</h3>
                <div v-if="loadingClassMembers" class="loading">
                  Loading members...
                </div>
                <div
                  v-else-if="classMembers.length > 0"
                  class="function-list class-members-list"
                >
                  <div
                    v-for="member in classMembers"
                    :key="member.id"
                    class="function-item member-item"
                    @click="selectFunction(member)"
                  >
                    <div class="function-name">
                      <span class="entity-type-badge type-function"
                        >method</span
                      >
                      {{ member.symbol }}{{ member.parameters || '' }}
                    </div>
                    <div class="function-location">
                      Line {{ member.start_line }}
                      <span v-if="member.return_type" class="member-return-type"
                        >→ {{ member.return_type }}</span
                      >
                    </div>
                  </div>
                </div>
                <div v-else class="empty-state">No member functions found</div>
              </div>

              <div class="tabs">
                <div
                  class="tab"
                  :class="{ active: activeTab === 'source' }"
                  @click="setActiveTab('source')"
                >
                  Source
                </div>
                <div
                  class="tab"
                  :class="{ active: activeTab === 'callgraph' }"
                  @click="setActiveTab('callgraph')"
                >
                  Call Graph
                </div>
                <div
                  class="tab"
                  :class="{ active: activeTab === 'flowchart' }"
                  @click="setActiveTab('flowchart')"
                >
                  Flowchart
                </div>
                <div
                  class="tab"
                  :class="{ active: activeTab === 'callers' }"
                  @click="setActiveTab('callers')"
                >
                  Callers ({{ callers.length || '...' }})
                </div>
                <div
                  class="tab"
                  :class="{ active: activeTab === 'callees' }"
                  @click="setActiveTab('callees')"
                >
                  Callees ({{ callees.length || '...' }})
                </div>
                <div
                  v-if="selectedFunction.type === 'struct' || selectedFunction.type === 'class'"
                  class="tab"
                  :class="{ active: activeTab === 'references' }"
                  @click="setActiveTab('references')"
                >
                  References ({{ entityReferences.length || '...' }})
                </div>
              </div>

              <div v-if="activeTab === 'source'">
                <div v-if="selectedFunction.source" class="code-block">
                  {{ selectedFunction.source }}
                </div>
                <div v-else class="empty-state">No source available</div>
              </div>

              <div v-if="activeTab === 'callgraph'">
                <!-- Depth Selector -->
                <div class="depth-selector" style="margin-bottom: 12px">
                  <label>Depth:</label>
                  <select
                    :value="inlineCallGraphDepth"
                    @change="setInlineCallGraphDepth(parseInt($event.target.value))"
                  >
                    <option :value="2">2</option>
                    <option :value="3">3</option>
                    <option :value="4">4</option>
                    <option :value="5">5</option>
                    <option :value="6">6</option>
                    <option :value="7">7</option>
                    <option :value="8">8</option>
                    <option :value="9">9</option>
                    <option :value="10">10</option>
                    <option :value="15">15</option>
                    <option :value="20">20</option>
                    <option :value="0">Unlimited</option>
                  </select>
                </div>
                <div v-if="loadingInlineCallGraph" class="loading">
                  Loading call graph...
                </div>
                <div v-else-if="inlineCallGraphError" class="empty-state">
                  {{ inlineCallGraphError }}
                </div>
                <div
                  v-else-if="inlineCallGraphData"
                  class="graph-container"
                  :class="{ 'fullscreen': inlineGraphFullscreen }"
                  ref="inlineGraphContainer"
                >
                  <div class="graph-controls">
                    <button @click="inlineGraphZoomIn">Zoom In</button>
                    <button @click="inlineGraphZoomOut">Zoom Out</button>
                    <button @click="inlineGraphResetZoom">Reset</button>
                    <button
                      class="fullscreen-btn"
                      @click="toggleInlineGraphFullscreen"
                    >
                      {{ inlineGraphFullscreen ? '✕ Close' : '⛶ Fullscreen' }}
                    </button>
                  </div>
                  <svg class="graph-svg" ref="inlineGraphSvg"></svg>
                  <div v-if="selectedInlineGraphNode" class="node-info-panel">
                    <div class="node-info-header">
                      {{ selectedInlineGraphNode.symbol }}{{
                      selectedInlineGraphNode.parameters || '' }}
                    </div>
                    <div class="node-info-body">
                      <div class="node-info-row">
                        <div class="node-info-label">Location</div>
                        <div class="node-info-value">
                          {{ selectedInlineGraphNode.filename }}:{{
                          selectedInlineGraphNode.start_line }}
                        </div>
                      </div>
                      <div
                        v-if="selectedInlineGraphNode.return_type"
                        class="node-info-row"
                      >
                        <div class="node-info-label">Return Type</div>
                        <div class="node-info-value">
                          {{ selectedInlineGraphNode.return_type }}
                        </div>
                      </div>
                      <div style="margin-top: 12px">
                        <button
                          class="btn-primary"
                          @click="selectFunction(selectedInlineGraphNode)"
                        >
                          View Details
                        </button>
                        <button
                          class="btn-secondary"
                          @click="recenterInlineGraph(selectedInlineGraphNode.symbol)"
                        >
                          Recenter Graph
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="graph-legend">
                    <div class="legend-item">
                      <div
                        class="legend-circle"
                        style="background: #fce4ec; border-color: #e91e63"
                      ></div>
                      <span>Root function</span>
                    </div>
                    <div class="legend-item">
                      <div
                        class="legend-circle"
                        style="background: #e3f2fd; border-color: #2196f3"
                      ></div>
                      <span>Related functions</span>
                    </div>
                    <div class="legend-item">
                      <span style="color: #999"
                        >→ Arrow shows call direction</span
                      >
                    </div>
                  </div>
                </div>
                <div v-else class="empty-state">
                  No call graph data available
                </div>
              </div>

              <div v-if="activeTab === 'flowchart'">
                <div v-if="loadingFlowchart" class="loading">
                  Loading flowchart...
                </div>
                <div v-else-if="flowchartError" class="empty-state">
                  {{ flowchartError }}
                </div>
                <div
                  v-else-if="flowchartData"
                  class="flowchart-container"
                  :class="{ 'fullscreen': flowchartFullscreen }"
                  ref="flowchartContainer"
                >
                  <div class="graph-controls">
                    <button @click="flowchartZoomIn">Zoom In</button>
                    <button @click="flowchartZoomOut">Zoom Out</button>
                    <button @click="flowchartResetZoom">Reset</button>
                    <button
                      class="fullscreen-btn"
                      @click="toggleFlowchartFullscreen"
                    >
                      {{ flowchartFullscreen ? '✕ Close' : '⛶ Fullscreen' }}
                    </button>
                  </div>
                  <svg class="flowchart-svg" ref="flowchartSvg"></svg>
                  <div
                    v-if="selectedFlowchartNode"
                    class="flowchart-info-panel"
                  >
                    <div class="flowchart-info-header">
                      <span class="flowchart-info-type"
                        >{{ selectedFlowchartNode.type }}</span
                      >
                      <span
                        v-if="selectedFlowchartNode.line"
                        class="flowchart-info-line"
                        >Line {{ selectedFlowchartNode.line }}</span
                      >
                      <button
                        class="flowchart-info-close"
                        @click="selectedFlowchartNode = null"
                      >
                        &times;
                      </button>
                    </div>
                    <div class="flowchart-info-body">
                      <div
                        v-if="selectedFlowchartNode.full_label"
                        class="flowchart-info-label"
                      >
                        {{ selectedFlowchartNode.full_label }}
                      </div>
                      <div
                        v-if="selectedFlowchartNode.source_snippet"
                        class="flowchart-info-source"
                      >
                        <pre>{{ selectedFlowchartNode.source_snippet }}</pre>
                      </div>
                    </div>
                  </div>
                  <div class="flowchart-legend">
                    <div class="legend-item">
                      <div class="legend-shape legend-oval"></div>
                      <span>Start/End</span>
                    </div>
                    <div class="legend-item">
                      <div class="legend-shape legend-rect"></div>
                      <span>Process</span>
                    </div>
                    <div class="legend-item">
                      <div class="legend-shape legend-diamond"></div>
                      <span>Decision</span>
                    </div>
                    <div class="legend-item">
                      <div class="legend-shape legend-hexagon"></div>
                      <span>Loop</span>
                    </div>
                    <div class="legend-item">
                      <div class="legend-shape legend-return"></div>
                      <span>Return</span>
                    </div>
                  </div>
                </div>
                <div v-else class="empty-state">
                  No flowchart data available
                </div>
              </div>

              <div v-if="activeTab === 'callers'">
                <div v-if="loadingCallers" class="loading">Loading...</div>
                <div v-else-if="callers.length > 0">
                  <div
                    v-for="caller in callers"
                    :key="caller.caller_id"
                    class="caller-callee-item"
                    @click="navigateToFunction(caller.caller_symbol, caller.caller_filename)"
                  >
                    {{ caller.caller_symbol }} ({{ caller.caller_filename }}:{{
                    caller.caller_start_line }})
                  </div>
                </div>
                <div v-else class="empty-state">No callers found</div>
              </div>

              <div v-if="activeTab === 'callees'">
                <div v-if="loadingCallees" class="loading">Loading...</div>
                <div v-else-if="callees.length > 0">
                  <div
                    v-for="callee in callees"
                    :key="callee.callee_id"
                    class="caller-callee-item"
                    @click="navigateToFunction(callee.callee_symbol, callee.callee_filename)"
                  >
                    {{ callee.callee_symbol }}{{ callee.callee_parameters || ''
                    }} ({{ callee.callee_filename }}:{{ callee.callee_start_line
                    }})
                  </div>
                </div>
                <div v-else class="empty-state">No callees found</div>
              </div>

              <div v-if="activeTab === 'references'">
                <div v-if="loadingReferences" class="loading">
                  Loading references...
                </div>
                <div
                  v-else-if="entityReferences.length > 0"
                  class="references-container"
                >
                  <div class="references-summary">
                    Found {{ entityReferences.length }} reference(s) to {{
                    selectedFunction.symbol }}
                    <span
                      v-if="referenceDefinitions.length > 1"
                      class="definitions-note"
                    >
                      ({{ referenceDefinitions.length }} definitions found
                      across projects)
                    </span>
                  </div>

                  <!-- Definitions section - shows all struct/class definitions with this name -->
                  <div
                    v-if="referenceDefinitions.length > 0"
                    class="definitions-section"
                  >
                    <h4>Definitions</h4>
                    <div class="definitions-list">
                      <div
                        v-for="def in referenceDefinitions"
                        :key="def.id"
                        class="definition-item"
                        @click="navigateToDefinition(def)"
                      >
                        <span
                          class="entity-type-badge"
                          :class="'type-' + def.type"
                          >{{ def.type }}</span
                        >
                        <span class="definition-symbol">{{ def.symbol }}</span>
                        <span class="definition-location">
                          {{ def.project_name }} / {{ def.filename }}:{{
                          def.start_line }}
                        </span>
                      </div>
                    </div>
                  </div>

                  <!-- References grouped by type -->
                  <div class="references-by-type">
                    <div
                      v-for="(refs, refType) in groupedReferences"
                      :key="refType"
                      class="reference-type-group"
                    >
                      <h4>
                        {{ formatReferenceType(refType) }} ({{ refs.length }})
                      </h4>
                      <div class="reference-list">
                        <div
                          v-for="ref in refs"
                          :key="ref.id"
                          class="reference-item"
                        >
                          <div class="reference-location">
                            {{ ref.filename }}:{{ ref.line }}
                          </div>
                          <div v-if="ref.context" class="reference-context">
                            <code>{{ ref.context }}</code>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div v-else class="empty-state">
                  No references found for this {{ selectedFunction.type }}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Job Queue Panel (floating, hidden when jobs view is open) -->
      <div
        v-if="(jobs.length > 0 || jobQueueStats.running > 0) && !showJobsView"
        class="job-queue-panel"
        :class="{ 'job-queue-minimized': jobQueueMinimized }"
      >
        <div
          class="job-queue-header"
          @click="jobQueueMinimized = !jobQueueMinimized"
        >
          <h3>
            Job Queue
            <span
              v-if="jobQueueStats.running > 0"
              class="job-queue-badge running"
            >
              {{ jobQueueStats.running }} running
            </span>
            <span v-else-if="jobQueueStats.queued > 0" class="job-queue-badge">
              {{ jobQueueStats.queued }} queued
            </span>
          </h3>
          <button class="job-queue-toggle">
            {{ jobQueueMinimized ? '+' : '−' }}
          </button>
        </div>
        <div class="job-queue-body">
          <div v-if="jobs.length === 0" class="job-queue-empty">
            No jobs in queue
          </div>
          <div v-for="job in jobs" :key="job.id" class="job-item">
            <div class="job-item-header">
              <span class="job-item-type">{{ job.type }}</span>
              <span class="job-item-status" :class="job.status"
                >{{ job.status }}</span
              >
            </div>
            <div class="job-item-meta">
              {{ job.metadata?.name || job.metadata?.path || job.id }}
            </div>
            <div class="job-progress-bar">
              <div
                class="job-progress-fill"
                :class="job.status"
                :style="{ width: job.progress + '%' }"
              ></div>
            </div>
            <div v-if="job.error" class="job-item-error">{{ job.error }}</div>
          </div>
        </div>
        <div class="job-queue-stats">
          <span>Completed: {{ jobQueueStats.completed }}</span>
          <span>Failed: {{ jobQueueStats.failed }}</span>
          <span>Total: {{ jobQueueStats.total }}</span>
        </div>
      </div>

      <!-- Import Project Modal -->
      <div
        v-if="showImportModal"
        class="modal-overlay"
        @click.self="closeImportModal"
      >
        <div class="modal">
          <div class="modal-header">
            <h3>Import Project</h3>
            <button class="modal-close" @click="closeImportModal">
              &times;
            </button>
          </div>
          <div class="modal-body">
            <div v-if="importError" class="error-message">
              {{ importError }}
            </div>
            <div v-if="importSuccess" class="success-message">
              {{ importSuccess }}
            </div>

            <div class="form-group">
              <label for="importPath">Path or Git URL *</label>
              <input
                id="importPath"
                v-model="importPath"
                type="text"
                placeholder="e.g., /path/to/project or https://github.com/user/repo"
                :disabled="importing"
              />
              <div class="hint">
                Enter a local file path or a public Git repository URL
              </div>
            </div>

            <div class="form-group">
              <label for="importName">Project Name (optional)</label>
              <input
                id="importName"
                v-model="importName"
                type="text"
                placeholder="Leave blank to auto-detect from path"
                :disabled="importing"
              />
            </div>
          </div>
          <div class="modal-footer">
            <button
              class="btn-secondary"
              @click="closeImportModal"
              :disabled="importing"
            >
              Cancel
            </button>
            <button
              class="btn-primary"
              @click="importProject"
              :disabled="!importPath || importing"
            >
              {{ importing ? 'Importing...' : 'Import Project' }}
            </button>
          </div>
        </div>
      </div>

      <!-- Read-Only Mode Modal -->
      <div
        v-if="showReadOnlyModal"
        class="modal-overlay"
        @click.self="closeReadOnlyModal"
      >
        <div class="modal">
          <div class="modal-header">
            <h3>Read-Only Mode</h3>
            <button class="modal-close" @click="closeReadOnlyModal">
              &times;
            </button>
          </div>
          <div class="modal-body">
            <div class="read-only-message">
              <div class="read-only-icon">&#128274;</div>
              <p>CodeBuddy is running in <strong>read-only mode</strong>.</p>
              <p>
                Import and refresh operations are disabled. You can still browse
                and search existing projects.
              </p>
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn-primary" @click="closeReadOnlyModal">OK</button>
          </div>
        </div>
      </div>
    </div>

    <script type="module" src="/js/app.js"></script>
  </body>
</html>
